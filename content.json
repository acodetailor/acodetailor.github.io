{"meta":{"title":"Sam","subtitle":"ç”¨æˆ‘çš„åŒæ‰‹ï¼Œæˆå°±ä½ çš„æ¢¦æƒ³ã€‚ä¸€åº“~","description":"æ‚è®°","author":"Sam","url":"https://acodetailor.github.io","root":"/"},"pages":[{"title":"404 Not Foundï¼šè¯¥é¡µæ— æ³•æ˜¾ç¤º","date":"2021-03-30T07:24:39.640Z","updated":"2021-03-30T07:24:39.640Z","comments":false,"path":"/404.html","permalink":"https://acodetailor.github.io/404.html","excerpt":"","text":""},{"title":"ä¹¦å•","date":"2021-03-30T07:24:39.645Z","updated":"2021-03-30T07:24:39.644Z","comments":false,"path":"books/index.html","permalink":"https://acodetailor.github.io/books/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2021-03-30T07:24:39.644Z","updated":"2021-03-30T07:24:39.643Z","comments":false,"path":"about/index.html","permalink":"https://acodetailor.github.io/about/index.html","excerpt":"","text":"ä¸ªäººè¯¦ç»†ä»‹ç»"},{"title":"åˆ†ç±»","date":"2021-03-30T07:24:39.645Z","updated":"2021-03-30T07:24:39.645Z","comments":false,"path":"categories/index.html","permalink":"https://acodetailor.github.io/categories/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2021-03-30T07:24:39.646Z","updated":"2021-03-30T07:24:39.646Z","comments":true,"path":"links/index.html","permalink":"https://acodetailor.github.io/links/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2021-03-30T07:24:39.647Z","updated":"2021-03-30T07:24:39.647Z","comments":false,"path":"repository/index.html","permalink":"https://acodetailor.github.io/repository/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2021-03-30T07:24:39.648Z","updated":"2021-03-30T07:24:39.648Z","comments":false,"path":"tags/index.html","permalink":"https://acodetailor.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Minikubeæ­å»ºistioå’ŒKnative","slug":"install knative","date":"2021-04-19T09:26:51.731Z","updated":"2021-04-19T09:49:08.653Z","comments":true,"path":"2021/04/19/install knative/","link":"","permalink":"https://acodetailor.github.io/2021/04/19/install%20knative/","excerpt":"","text":"éœ€è¦æ­å»ºä¸€å¥—knativeçš„æµ‹è¯•ç¯å¢ƒï¼Œä½†æ˜¯æ²¡æœ‰æµ‹è¯•é›†ç¾¤å¯ä»¥ç”¨äº†ï¼Œå°±ç”¨è‡ªå·±çš„ç”µè„‘æ­å»ºäº†ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒã€‚æ­å»ºè¿‡ç¨‹è®°å½•ä¸€ä¸‹ ç¯å¢ƒä¿¡æ¯os:MacDriver:VirtualBox æ­å»ºminikubeä¸€æ¡å‘½ä»¤å³å¯,å¯ä»¥æŒ‡å®šcpuå’Œå†…å­˜â€“cpus int â€“memory int 1minikube start --vm-driver=virtualbox --image-repository=&#x27;registry.cn-hangzhou.aliyuncs.com/google_containers&#x27; minikubeå¸¸ç”¨å‘½ä»¤ 123456789101112131415161718191. minikube start å¯åŠ¨minikube2. minikube dashboard æ‰“å¼€dashboard3. minikube version æŸ¥çœ‹minikubeç‰ˆæœ¬4. minikube status æŸ¥çœ‹é›†ç¾¤çŠ¶æ€5. minikube ip æ˜¾ç¤ºè™šæ‹Ÿæœºipåœ°å€6. minikube stop åœæ­¢è™šæ‹Ÿæœº7. minikube ssh sshåˆ°è™šæ‹Ÿæœºä¸­8. minikube delete åˆ é™¤è™šæ‹Ÿæœº9. minikube logs æŸ¥çœ‹è™šæ‹Ÿæœºæ—¥å¿—10. minikube update-check æ£€æŸ¥æ›´æ–°11. minikube node list[add|start|stop|delete] å¯¹èŠ‚ç‚¹è¿›è¡Œæ“ä½œ12. minikube mount å°†æŒ‡å®šçš„ç›®å½•æŒ‚è½½åˆ°minikube13. minikube docker-env é…ç½®ç¯å¢ƒä»¥ä½¿ç”¨minikubeçš„dockerå®ˆæŠ¤è¿›ç¨‹14. minikube podman-env é…ç½®ç¯å¢ƒä»¥ä½¿ç”¨minikubeçš„PodmanæœåŠ¡15. minikube cache æ·»åŠ ï¼Œåˆ é™¤ï¼Œæˆ–æ¨é€ä¸€ä¸ªæœ¬åœ°æ˜ åƒåˆ°minikube16. minikube addons å¯ç”¨æˆ–ç¦ç”¨ä¸€ä¸ªminikubeæ’ä»¶17. minikube config ä¿®æ”¹æŒä¹…åŒ–é…ç½®å€¼18. minikube profile è·å–æˆ–è€…åˆ—å‡ºå½“å‰çš„é…ç½®æ–‡ä»¶ï¼ˆé›†ç¾¤ï¼‰19. minikube update-context åœ¨IPæˆ–è€…ç«¯å£æ”¹å˜çš„æƒ…å†µä¸‹æ›´æ–°kubeconfig å®‰è£…æˆåŠŸåæç¤ºå¦‚ä¸‹ï¼š 12345678910ğŸ˜„ Darwin 10.14.6 ä¸Šçš„ minikube v1.8.2âœ¨ æ ¹æ®ç°æœ‰çš„é…ç½®æ–‡ä»¶ä½¿ç”¨ virtualbox é©±åŠ¨ç¨‹åºâœ… æ­£åœ¨ä½¿ç”¨é•œåƒå­˜å‚¨åº“ registry.cn-hangzhou.aliyuncs.com/google_containersğŸ’¾ Downloading preloaded images tarball for k8s v1.17.3 ...âŒ› é‡æ–°é…ç½®ç°æœ‰ä¸»æœºğŸƒ Using the running virtualbox &quot;minikube&quot; VM ...ğŸ³ æ­£åœ¨ Docker 19.03.6 ä¸­å‡†å¤‡ Kubernetes v1.17.3â€¦ğŸš€ æ­£åœ¨å¯åŠ¨ Kubernetes ... ğŸŒŸ Enabling addons: default-storageclass, storage-provisionerğŸ„ å®Œæˆï¼kubectl å·²ç»é…ç½®è‡³ &quot;minikube&quot; æ­å»ºistioä¸‹è½½istioçš„åŒ…ï¼Œç„¶åæ ¹æ®æç¤ºé…ç½®ç¯å¢ƒå˜é‡ï¼Œç”±äºæŸäº›å·²çŸ¥åŸå› ï¼Œå¯ä»¥é…ç½®host 1199.232.28.133 raw.githubusercontent.com 1curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.9.1 TARGET_ARCH=x86_64 sh - å®‰è£…å‘½ä»¤ï¼šæ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„profile 12istioctl manifest apply --set profile=demo //ä½¿ç”¨è¿™æ¡å‘½ä»¤å®‰è£…å¤±è´¥äº†ã€‚istioctl install --set profile=demo -y æ­å»ºknativeknativeæ­å»ºæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼Œå†éº»çƒ¦ä¸€ç‚¹ï¼Œå¯ä»¥è‡ªå·±ä¸‹è½½yamlæ‰‹åŠ¨æ‰§è¡Œï¼Œservingå’Œeventingä¸€å…±å››ä¸ªyaml 1234serving-crdsserving-coreeventing-crdseventing-core 1kubectl apply --filename &quot;https://github.com/knative/serving/releases/download/v0.17.0/serving-crds.yaml&quot; æ¯”è¾ƒéº»çƒ¦çš„æ˜¯é•œåƒï¼Œå›½å†…æ— æ³•ç›´æ¥ä¸‹è½½åˆ°ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½åï¼Œä½¿ç”¨minikube cache æ·»åŠ åˆ°minikubeçš„èŠ‚ç‚¹ä¸Šã€‚ ç»“æœ","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"}]},{"title":"è®°ä¸€æ¬¡OOMçš„é—®é¢˜æ’æŸ¥","slug":"ops-oom","date":"2021-04-12T13:03:40.025Z","updated":"2021-04-12T13:34:52.892Z","comments":true,"path":"2021/04/12/ops-oom/","link":"","permalink":"https://acodetailor.github.io/2021/04/12/ops-oom/","excerpt":"","text":"ä¸€ã€é—®é¢˜ç°è±¡ ä¸‰å¤©å‰ï¼Œä¸šåŠ¡çš„podé‡å¯äº†ï¼Œä¸šåŠ¡æƒ³çŸ¥é“å…·ä½“åŸå› ã€‚ äºŒã€æ’æŸ¥è®°å½• é¦–å…ˆæ’æŸ¥kubeletæ—¥å¿—ï¼Œè›‹ç–¼çš„æ˜¯æœŸé—´ä¸šåŠ¡æ‰‹åŠ¨é‡å¯äº†å‡ æ¬¡ï¼Œå¯¼è‡´ä¸çŸ¥é“podé‡å¯æ—¶æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚ä¸€ä¸ªä¸ªèŠ‚ç‚¹æ’æŸ¥kubeletçš„æ—¥å¿—ï¼ˆä¸çŸ¥é“åç»­æœ‰æ²¡æœ‰å¥½çš„æ–¹æ³•ï¼‰ï¼Œæ‰¾åˆ°èŠ‚ç‚¹å‘ç°æ—¥å¿—å¦‚ä¸‹ï¼š kubeletæ‰§è¡ŒPLEGæ—¶å‘ç°å®¹å™¨æŒ‚æ‰äº†ï¼Œç›´æ¥ç»™æ‹‰èµ·äº†ï¼Œå°±æ˜¯ä¸šåŠ¡å‰å°å‘ç°çš„é‡å¯äº‹ä»¶ã€‚ å†æ’æŸ¥ä¸šåŠ¡æ—¥å¿—ï¼Œå‘ç°åªæœ‰Killed,å…«æˆæ˜¯OOMäº†ã€‚æ—¥å¿—æˆªå›¾å¦‚ä¸‹ï¼š ä¸‹ä¸€æ­¥æ’æŸ¥å†…æ ¸æ—¥å¿—ï¼Œkerenalã€‚å‘ç°ç¡®å®æ˜¯OOMäº†ã€‚æˆªå›¾å¦‚ä¸‹: ç„¶åé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬çš„ç›‘æ§å‘ç°å¹¶æ²¡æœ‰è¾¾åˆ°å†…å­˜çš„ä¸Šé™ï¼Œä½†æ˜¯cgroupç¡®å®è¾¾åˆ°äº†ä¸Šé™ã€‚çœŸæ˜¯è®©äººå¤´å¤§å•Šã€‚ ä¸‰ã€å‡ ä¸ªå‘½ä»¤12zgrep &quot;&quot; *.gzjournalctl --since &#x27;2021-04-09 22:00&#x27; å››ã€å¼•ç”³é—®é¢˜ 1ã€cgroupçš„æœºåˆ¶ 2ã€javaçš„å†…å­˜æœºåˆ¶","categories":[{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://acodetailor.github.io/categories/%E8%BF%90%E7%BB%B4/"}],"tags":[{"name":"oom","slug":"oom","permalink":"https://acodetailor.github.io/tags/oom/"}]},{"title":"","slug":"TCP","date":"2021-04-09T06:37:26.865Z","updated":"2021-04-09T06:37:26.865Z","comments":true,"path":"2021/04/09/TCP/","link":"","permalink":"https://acodetailor.github.io/2021/04/09/TCP/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"","slug":"Iptabels And Ipvs","date":"2021-04-09T06:37:13.851Z","updated":"2021-04-09T06:37:13.851Z","comments":true,"path":"2021/04/09/Iptabels And Ipvs/","link":"","permalink":"https://acodetailor.github.io/2021/04/09/Iptabels%20And%20Ipvs/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"terraform cloud CLI","slug":"terraform_cloud","date":"2021-04-07T02:02:39.990Z","updated":"2021-04-07T05:41:50.275Z","comments":true,"path":"2021/04/07/terraform_cloud/","link":"","permalink":"https://acodetailor.github.io/2021/04/07/terraform_cloud/","excerpt":"","text":"ä¸€ã€ç®€ä»‹ terraformè‡ªèº«æä¾›å¯ä¸€ä¸ªæœºåˆ¶ï¼ˆç±»ä¼¼CI/CDçš„æµæ°´çº¿ï¼‰ï¼Œå¯ä»¥é…ç½®è‡ªå·±çš„gitåº“ï¼Œæ ¹æ®gitåº“æ–‡ä»¶å†…å®¹çš„å˜åŒ–ï¼Œæ‰§è¡Œplanã€applyï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œã€‚ä»¥åŠé…ç½®å˜é‡æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€stateæ–‡ä»¶ç»Ÿä¸€å­˜å‚¨ç­‰ç­‰åŠŸèƒ½ã€‚ äºŒã€å¯¹æ¯”1ã€ä½¿ç”¨terraformäºŒè¿›åˆ¶ã€‚ éœ€è¦ä¸‹è½½provider(terraform init) ç¼–å†™tfæ–‡ä»¶ï¼Œbackendå­˜å‚¨ã€‚ä¹Ÿéœ€è¦ç»Ÿä¸€çš„é…ç½®ç®¡ç†ã€‚ æ¯æ¬¡æ‰‹åŠ¨è§¦å‘ã€‚ 2ã€ä½¿ç”¨Cloud CLIã€‚ ä¸éœ€è¦å‡†å¤‡provider ç»Ÿä¸€çš„é…ç½®ç®¡ç† git pushåå³è§¦å‘ terraform ä¸‰ã€æ —å­1ã€åˆ›å»ºç»„ç»‡ terraformç½‘ç«™åˆ›å»ºå³å¯ã€‚ https://app.terraform.io2ã€é…ç½®gitåº“ å¯ä»¥ä½¿ç”¨ä¸ªäººçš„gitåº“ï¼Œé…ç½®Oauthæƒé™ã€‚æ ¹æ®æç¤º åœ¨github-&gt;setting-&gt;developer settings-&gt; oauth appsç”³è¯·é…ç½®å³å¯ã€‚ 3ã€é€‰æ‹©å·¥ç¨‹ gitæ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œç„¶åå†terraformå¤„é€‰æ‹©è¯¥å·¥ç¨‹ã€‚ 4ã€æµ‹è¯• æ‰§è¡ŒRunå³å¯ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šè§¦å‘ plan,ç„¶åéœ€è¦æ‰‹åŠ¨æ‰§è¡Œapplyã€‚ 5ã€ç»“æœ","categories":[{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/categories/terraform/"}],"tags":[{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/tags/terraform/"}]},{"title":"Kubernetes CRD -- kubebuilderæ­å»º","slug":"k8s_crd","date":"2021-04-02T02:17:18.350Z","updated":"2021-04-02T03:53:26.061Z","comments":true,"path":"2021/04/02/k8s_crd/","link":"","permalink":"https://acodetailor.github.io/2021/04/02/k8s_crd/","excerpt":"","text":"æ¦‚å¿µå®˜æ–¹è§£é‡Šï¼šCustomResourceDefinition API èµ„æºå…è®¸ä½ å®šä¹‰å®šåˆ¶èµ„æºã€‚ å®šä¹‰ CRD å¯¹è±¡çš„æ“ä½œä¼šä½¿ç”¨ä½ æ‰€è®¾å®šçš„åå­—å’Œæ¨¡å¼å®šä¹‰ï¼ˆSchemaï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„å®šåˆ¶èµ„æºï¼Œ Kubernetes API è´Ÿè´£ä¸ºä½ çš„å®šåˆ¶èµ„æºæä¾›å­˜å‚¨å’Œè®¿é—®æœåŠ¡ã€‚ CRD å¯¹è±¡çš„åç§°å¿…é¡»æ˜¯åˆæ³•çš„ DNS å­åŸŸåã€‚ DNSå­åŸŸåè§„åˆ™å¦‚ä¸‹ï¼š ä¸èƒ½è¶…è¿‡253ä¸ªå­—ç¬¦ åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠâ€™-â€˜ å’Œ â€˜.â€™ é¡»ä»¥å­—æ¯æ•°å­—å¼€å¤´ é¡»ä»¥å­—æ¯æ•°å­—ç»“å°¾ ç®€å•æ¥è¯´ï¼Œä½ å¯ä»¥å®šä¹‰åƒk8såŸç”Ÿèµ„æºå¦‚deploymentã€serviceä¸€æ ·å®šä¹‰è‡ªå·±çš„èµ„æºï¼Œè€Œk8sä¼šä¸ºä½ æä¾›å­˜å‚¨ï¼ˆETCDï¼‰,è®¿é—®ï¼ˆkube-apiserverï¼‰ã€‚ è„šæ‰‹æ¶kubebuilder å’Œ operator sdk, ä¸ªäººåªä½¿ç”¨è¿‡kubebuilderã€‚ å®‰è£…kubebuilderä¾èµ–1ã€docker2ã€go å»ºè®®ç‰ˆæœ¬åœ¨1.12ä»¥ä¸Šï¼Œæ”¯æŒ go mod3ã€kustomize ä»£ç†é…ç½®é…ç½®ä¸€ä¸‹ ç»ˆç«¯ä»£ç†ï¼Œå› ä¸ºåˆå§‹åŒ–æ—¶ä¼šæ‹‰å»goçš„ä¾èµ–åŒ…ã€‚go 1.12ä¹‹ä¸‹å¼€å¯ go module 12export GOPROXY=https://goproxy.ioexport GO111MODULE=on å®‰è£…ä¸€ã€å®‰è£…kubebuilderæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚ï¼ˆå¦‚æœcurlä¸‹è½½å¤±è´¥ï¼Œå¤§æ¦‚ç‡æ˜¯ç½‘ç»œåŸå› ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ï¼Œè§£å‹åˆ°æŒ‡å®šç›®å½•ï¼‰ã€‚ 12345os= $(go env GOOS)arch=$(go env GOARCH)curl -L https://go.kubebuilder.io/dl/2.3.1/$&#123;os&#125;/$&#123;arch&#125; | tar -xz -C /tmp/sudo mv /tmp/kubebuilder_2.3.1_$&#123;os&#125;_$&#123;arch&#125; /usr/local/kubebuilderexport PATH=$PATH:/usr/local/kubebuilder/bin äºŒã€å®‰è£…kustomize 1brew install kustomize ä¸‰ã€å®‰è£…å®ŒæˆåæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ 12345$ kubebuilder versionVersion: version.Version&#123;KubeBuilderVersion:&quot;2.3.1&quot;, KubernetesVendor:&quot;1.16.4&quot;, GitCommit:&quot;8b53abeb4280186e494b726edf8f54ca7aa64a49&quot;, BuildDate:&quot;2020-03-26T16:42:00Z&quot;, GoOs:&quot;unknown&quot;, GoArch:&quot;unknown&quot;&#125;# sam @ MacBook-Pro-2 in ~/tf/alitest [10:45:37]$ kustomize version&#123;Version:kustomize/v3.8.2 GitCommit:e2973f6ecc9be6187cfd5ecf5e180f842249b3c6 BuildDate:2020-09-02T07:01:55+01:00 GoOs:darwin GoArch:amd64&#125; å››ã€åˆå§‹åŒ–å·¥ç¨‹ 12kubebuilder init --domain my.crd.com //åˆå§‹åŒ–å·¥ç¨‹kubebuilder create api --group custom --version v1 --kind Unit //ç”Ÿæˆè„šæ‰‹æ¶ä»£ç  group: æ¯”å¦‚èµ„æºæ–‡ä»¶çš„apps/v1, appså³ä¸ºåˆ†ç»„ï¼Œè¿˜æœ‰å…¶ä»–extensionsã€coresç­‰ã€‚ version: é¡¾åæ€ä¹‰ã€v1å³ä¸ºç‰ˆæœ¬ã€‚ kind: API â€œé¡¶çº§â€èµ„æºå¯¹è±¡çš„ç±»å‹ï¼Œæ¯ä¸ªèµ„æºå¯¹è±¡éƒ½éœ€è¦ Kind æ¥åŒºåˆ†å®ƒè‡ªèº«ä»£è¡¨çš„èµ„æºç±»å‹ã€‚æ¯”å¦‚ pod,deployment. resource: é€šè¿‡ HTTP åè®®ä»¥ JSON æ ¼å¼å‘é€æˆ–è€…è¯»å–çš„èµ„æºå±•ç°å½¢å¼ï¼Œå¯ä»¥ä»¥å•ä¸ªèµ„æºå¯¹è±¡å±•ç°ã€‚ GVK(groupã€versionã€kind):åŒ Kind ä¸æ­¢å¯ä»¥å‡ºç°åœ¨åŒä¸€åˆ†ç»„çš„ä¸åŒç‰ˆæœ¬ä¸­ï¼Œå¦‚ apps/v1beta1 ä¸ apps/v1ï¼Œå®ƒè¿˜å¯èƒ½å‡ºç°åœ¨ä¸åŒçš„åˆ†ç»„ä¸­ï¼Œä¾‹å¦‚ Deployment å¼€å§‹ä»¥ alpha çš„ç‰¹æ€§å‡ºç°åœ¨ extensions åˆ†ç»„ï¼ŒGA ä¹‹åè¢«æ¨è¿›åˆ° apps ç»„ï¼Œæ‰€ä»¥ä¸ºäº†ä¸¥æ ¼åŒºåˆ†ä¸åŒçš„ Kindï¼Œéœ€è¦ç»„åˆ API Groupã€API Version ä¸ Kind æˆä¸º GVKã€‚ GVR(groupã€versionã€resource):GVR å¸¸ç”¨äºç»„åˆæˆ RESTful API è¯·æ±‚è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œé’ˆå¯¹åº”ç”¨ç¨‹åº v1 éƒ¨ç½²çš„ RESTful API è¯·æ±‚å¦‚ä¸‹æ‰€ç¤ºï¼š 1GET /apis/apps/v1/namespaces/&#123;namespace&#125;/deployments/&#123;name&#125;","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"}]},{"title":"Terraformä»‹ç»","slug":"terraform","date":"2021-03-30T02:38:39.714Z","updated":"2021-04-01T08:23:43.207Z","comments":true,"path":"2021/03/30/terraform/","link":"","permalink":"https://acodetailor.github.io/2021/03/30/terraform/","excerpt":"","text":"ç®€ä»‹ï¼šTerraformæ˜¯IT åŸºç¡€æ¶æ„è‡ªåŠ¨åŒ–ç¼–æ’å·¥å…·ï¼Œå®ƒçš„å£å·æ˜¯ â€œWrite,Plan, and create Infrastructure as Codeâ€, åŸºç¡€æ¶æ„å³ä»£ç ã€‚ æ€ä¹ˆç†è§£è¿™å¥è¯ï¼Œæˆ‘ä»¬å…ˆå‡è®¾åœ¨æ²¡æœ‰Terraformçš„å¹´ä»£æˆ‘ä»¬æ˜¯æ€ä¹ˆæ“ä½œäº‘æœåŠ¡ã€‚ æ–¹å¼ä¸€ï¼šç›´æ¥ç™»å…¥åˆ°äº‘å¹³å°çš„ç®¡æ§é¡µé¢ï¼Œäººå·¥ç‚¹å‡»æŒ‰é’®ã€é”®ç›˜æ•²å…¥è¾“å…¥å‚æ•°çš„æ–¹å¼æ¥æ“ä½œï¼Œè¿™ç§æ–¹å¼å¯¹äºå•ä¸ªæˆ–å‡ ä¸ªäº‘æœåŠ¡å™¨è¿˜å¯ä»¥ç»´æŠ¤çš„è¿‡æ¥ï¼Œä½†æ˜¯å½“äº‘æœåŠ¡è§„æ¨¡è¾¾åˆ°å‡ åå‡ ç™¾ç”šè‡³ä¸Šåƒä»¥åï¼Œæ˜æ˜¾è¿™ç§æ–¹å¼å¯¹äºäººåŠ›æ¥è¯´å˜å¾—ä¸å†ç°å®ï¼Œè€Œä¸”å®¹æ˜“è¯¯æ“ä½œã€‚ æ–¹å¼äºŒï¼šäº‘å¹³å°æä¾›äº†å„ç§SDKï¼Œå°†å¯¹äº‘æœåŠ¡çš„æ“ä½œæ‹†è§£æˆä¸€ä¸ªä¸ªçš„APIä¾›ä½¿ç”¨å‚å•†é€šè¿‡ä»£ç æ¥è°ƒç”¨ã€‚è¿™ç§æ–¹å¼æ˜æ˜¾å¥½äºæ–¹å¼ä¸€ï¼Œä½¿å¤§æ‰¹é‡æ“ä½œå˜å¾—å¯èƒ½ï¼Œè€Œä¸”ä»£ç æµ‹è¯•é€šè¿‡åå¯ä»¥é¿å…äººä¸ºè¯¯æ“ä½œã€‚ä½†æ˜¯éšä¹‹å¸¦æ¥çš„é—®é¢˜æ˜¯å‚å•†ä»¬éœ€è¦ä¸“ä¸šçš„å¼€å‘äººå‘˜ï¼ˆJavaã€Pythonã€Phpã€Rubyç­‰ï¼‰ï¼Œè€Œä¸”å¯¹å¤æ‚äº‘å¹³å°çš„æ“ä½œéœ€è¦å†™å¤§é‡çš„ä»£ç ã€‚ æ–¹å¼ä¸‰ï¼šäº‘å¹³å°æä¾›äº†å‘½ä»¤è¡Œæ“ä½œäº‘æœåŠ¡çš„å·¥å…·ï¼Œä¾‹å¦‚AWS CLIï¼Œè¿™æ ·ç§Ÿæˆ·å‚å•†ä¸å†éœ€è¦è½¯ä»¶å¼€å‘äººå‘˜å°±å¯ä»¥å®ç°å¯¹å¹³å°çš„å‘½ä»¤æ“ä½œã€‚å‘½ä»¤å°±åƒSqlä¸€æ ·ï¼Œä½¿ç”¨å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œå…ƒç´ æ¥ç®¡ç†äº‘ã€‚ æ–¹å¼å››ï¼šTerraformä¸»è§’ç™»åœºï¼Œå¦‚æœè¯´æ–¹å¼ä¸‰ä¸­CLIæ˜¯å‘½ä»¤å¼æ“ä½œï¼Œéœ€è¦æ˜ç¡®çš„å‘ŠçŸ¥äº‘æœåŠ¡æœ¬æ¬¡æ“ä½œæ˜¯æŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€è¿˜æ˜¯åˆ é™¤ï¼Œé‚£ä¹ˆTerraformå°±æ˜¯ç›®çš„å¼æ“ä½œï¼Œåœ¨æœ¬åœ°ç»´æŠ¤äº†ä¸€ä»½äº‘æœåŠ¡çŠ¶æ€çš„æ¨¡æ¿ï¼Œæ¨¡æ¿ç¼–æ’æˆä»€ä¹ˆæ ·å­çš„ï¼Œäº‘æœåŠ¡å°±æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚å¯¹æ¯”æ–¹å¼ä¸‰çš„ä¼˜åŠ¿æ˜¯æˆ‘ä»¬åªéœ€è¦ä¸“æ³¨äºç¼–æ’ç»“æœå³å¯ï¼Œä¸éœ€è¦å…³å¿ƒç”¨ä»€ä¹ˆå‘½ä»¤å»æ“ä½œã€‚ Terraformçš„æ„ä¹‰åœ¨äºï¼Œé€šè¿‡åŒä¸€å¥—è§„åˆ™å’Œå‘½ä»¤æ¥æ“ä½œä¸åŒçš„äº‘å¹³å°ï¼ˆåŒ…æ‹¬ç§æœ‰äº‘ï¼‰ã€‚ TerraformçŸ¥è¯†å‡†å¤‡ï¼šæ ¸å¿ƒæ–‡ä»¶æœ‰2ä¸ªï¼Œä¸€ä¸ªæ˜¯ç¼–æ’æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯çŠ¶æ€æ–‡ä»¶ main.tfæ–‡ä»¶ï¼šæ˜¯ä¸šåŠ¡ç¼–æ’çš„ä¸»æ–‡ä»¶ï¼Œå®šåˆ¶äº†ä¸€ç³»åˆ—çš„ç¼–æ’è§„åˆ™ï¼Œåé¢ä¼šæœ‰è¯¦ç»†ä»‹ç»ã€‚ terraform.tfstateï¼šæœ¬åœ°çŠ¶æ€æ–‡ä»¶ï¼Œç›¸å½“äºæœ¬åœ°çš„äº‘æœåŠ¡çŠ¶æ€çš„å¤‡ä»½ï¼Œä¼šå½±å“terraformçš„æ‰§è¡Œè®¡åˆ’ã€‚ å¦‚æœæœ¬åœ°çŠ¶æ€ä¸äº‘æœåŠ¡çŠ¶æ€ä¸ä¸€æ ·æ—¶ä¼šæ€æ ·ï¼Ÿ è¿™ä¸ªå¤§å®¶ä¸éœ€è¦æ‹…å¿ƒï¼Œå‰é¢ä»‹ç»è¿‡Terraformæ˜¯ç›®çš„å¼çš„ç¼–æ’ï¼Œä¼šæŒ‰ç…§é¢„è®¾ç»“æœå®Œæˆç¼–æ’å¹¶æœ€ç»ˆåŒæ­¥æ›´æ–°æœ¬åœ°æ–‡ä»¶ã€‚ Providerï¼šTerraformå®šåˆ¶çš„ä¸€å¥—æ¥å£ï¼Œè·ŸOpenStacké‡ŒDirverã€Javaé‡ŒInterfaceçš„æ¦‚å¿µæ˜¯ä¸€æ ·çš„ï¼Œé˜¿é‡Œäº‘ã€AWSã€ç§æœ‰äº‘ç­‰å¦‚æœæƒ³æ¥å…¥è¿›æ¥è¢«Terraformç¼–æ’å’Œç®¡ç†å°±è¦å®ç°ä¸€å¥—Providerï¼Œè€Œè¿™äº›å®ç°å¯¹äºTerraformçš„é¡¶å±‚ä½¿ç”¨è€…æ¥è¯´æ˜¯æ— æ„ŸçŸ¥çš„ã€‚ Moduleï¼šå¯ä»¥ç†è§£ä¸ºproviderçš„é›†åˆï¼Œå®Œæˆä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½ã€‚ ç›¸å…³å‘½ä»¤ï¼šåˆå§‹åŒ–åˆå§‹åŒ–æœ¬åœ°ç¯å¢ƒï¼Œä¸‹è½½provider,æ ¡éªŒterraformç‰ˆæœ¬ç­‰. 12$ terraform init //è‡ªåŠ¨ä¸‹è½½æœ€æ–°çš„provider$ terraform init -plugin-dir //æŒ‡å®šproviderç›®å½• planæ¯”è¾ƒäº‘ç«¯èµ„æºå’Œæœ¬åœ°stateèµ„æº. 1$ terraform plan éƒ¨ç½²å°†ä¿®æ”¹éƒ¨ç½²åˆ°äº‘ç«¯èµ„æº. 1$ terraform apply åˆ é™¤å°†äº‘ç«¯èµ„æºåˆ é™¤. 1$ terraform destory Exampleåˆ›å»ºé˜¿é‡Œäº‘ç”¨æˆ·ç»„ã€èµ„æºç»„å¹¶ä¸”é…ç½®åªè¯»æƒé™ã€‚æ³¨: alicloud : é˜¿é‡Œäº‘provideråå­—ï¼Œä¸èƒ½ä¿®æ”¹ã€‚ 1234567891011121314151617181920212223242526provider &quot;alicloud&quot; &#123; access_key = &quot;*******************&quot; secret_key = &quot;*************************&quot; region = &quot;cn-beijing&quot; &#125; resource &quot;alicloud_ram_group&quot; &quot;group&quot; &#123; name = &quot;test_group_1000&quot; force = true &#125; resource &quot;alicloud_ram_group_policy_attachment&quot; &quot;attach&quot; &#123; policy_name = &quot;ReadOnlyAccess&quot; policy_type = &quot;System&quot; group_name = alicloud_ram_group.group.name &#125; resource &quot;alicloud_resource_manager_resource_group&quot; &quot;example&quot; &#123; resource_group_name = &quot;tftest01&quot; display_name = &quot;tftest01&quot; &#125; data &quot;alicloud_account&quot; &quot;example&quot; &#123;&#125; resource &quot;alicloud_resource_manager_policy_attachment&quot; &quot;example&quot; &#123; policy_name = &quot;ReadOnlyAccess&quot; policy_type = &quot;System&quot; principal_name = format(&quot;%s@group.%s.onaliyun.com&quot;, alicloud_ram_group.group.name, data.alicloud_account.example.id) principal_type = &quot;IMSGroup&quot; resource_group_id = alicloud_resource_manager_resource_group.example.id &#125; å…¶ä»–1ã€é…ç½®terraformè‡ªåŠ¨è¡¥å…¨ 1$ terraform -install-autocomplete 2ã€æŸ¥çœ‹terraformçš„æ—¥å¿— 12$ export TF_LOG=TRACE$ export TF_LOG_PATH=/var/log/terraform.log 3ã€terraform é€šè¿‡é…ç½®æ–‡ä»¶æˆ–è€…ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®æ–‡ä»¶ç›®å½•(è‡ªå·±åˆ›å»º) 1$ $HOME/.terraformrc ç¯å¢ƒå˜é‡ 1$ os.Setenv(&quot;TF_PLUGIN_CACHE_DIR&quot;, &quot;/tmp/provider&quot;) // add provider cache stateæ–‡ä»¶å­˜å‚¨ï¼Œæ”¯æŒconsulã€ossç­‰12345678910111213terraform &#123; backend &quot;consul&quot; &#123; address = &quot;consul.example.com&quot; scheme = &quot;https&quot; path = &quot;full/path&quot; &#125;&#125;data &quot;terraform_remote_state&quot; &quot;foo&quot; &#123; backend = &quot;consul&quot; config = &#123; path = &quot;full/path&quot; &#125;&#125; å‚è€ƒï¼š https://theithollow.com/2018/05/21/using-hashicorp-consul-to-store-terraform-state/ è¯­æ³• å•è¡Œæ³¨é‡Šä»¥ # å¼€å¤´ å¤šè¡Œæ³¨é‡Šç”¨ /* å’Œ */ æ¢è¡Œ å€¼ä½¿ç”¨ key = value çš„è¯­æ³•åˆ†é…ï¼ˆç©ºæ ¼æ— å…³ç´§è¦ï¼‰ã€‚è¯¥å€¼å¯ä»¥æ˜¯ä»»ä½•åŸè¯­ï¼ˆå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œå¸ƒå°”å€¼ï¼‰ï¼Œåˆ—è¡¨æˆ–æ˜ å°„ã€‚ å­—ç¬¦ä¸²ä¸ºåŒå¼•å·ã€‚ å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ ${} åŒ…è£…çš„è¯­æ³•å¯¹å…¶ä»–å€¼è¿›è¡Œæ’å€¼ï¼Œä¾‹å¦‚ ${var.foo} ã€‚æ­¤å¤„è®°å½•äº†å®Œæ•´çš„å†…æ’è¯­æ³•ã€‚ å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨å¤–å£³æ ·å¼çš„â€œ here docâ€è¯­æ³•ï¼Œè¯¥å­—ç¬¦ä¸²ä»¥ç±»ä¼¼ &lt;&lt;EOF çš„æ ‡è®°å¼€å¤´ï¼Œç„¶åä»¥ EOF ç»“å°¾ã€‚å­—ç¬¦ä¸²å’Œç»“æŸæ ‡å¿—çš„çº¿è·¯å¿…é¡»ä¸èƒ½ç¼©è¿›ã€‚ å‡å®šæ•°å­—ä»¥10ä¸ºåº•ã€‚å¦‚æœä¸ºæ•°å­—åŠ ä¸Š 0x å‰ç¼€ï¼Œåˆ™å°†å…¶è§†ä¸ºåå…­è¿›åˆ¶æ•°å­—ã€‚ å¸ƒå°”å€¼ï¼š true ï¼Œ false ã€‚ åŸå§‹ç±»å‹çš„åˆ—è¡¨å¯ä»¥ç”¨æ–¹æ‹¬å·ï¼ˆ [] ï¼‰åˆ¶æˆã€‚ç¤ºä¾‹ï¼š [â€œfooâ€, â€œbarâ€, â€œbazâ€] ã€‚ å‚è€ƒ https://runebook.dev/zh-CN/docs/terraform/-index-#Alicloud https://www.terraform.io/","categories":[{"name":"Cloud","slug":"Cloud","permalink":"https://acodetailor.github.io/categories/Cloud/"}],"tags":[{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/tags/terraform/"}]}],"categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"},{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://acodetailor.github.io/categories/%E8%BF%90%E7%BB%B4/"},{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/categories/terraform/"},{"name":"Cloud","slug":"Cloud","permalink":"https://acodetailor.github.io/categories/Cloud/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"},{"name":"oom","slug":"oom","permalink":"https://acodetailor.github.io/tags/oom/"},{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/tags/terraform/"}]}