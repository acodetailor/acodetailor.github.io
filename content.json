{"meta":{"title":"Sam","subtitle":"ç”¨æˆ‘çš„åŒæ‰‹ï¼Œæˆå°±ä½ çš„æ¢¦æƒ³ã€‚ä¸€åº“~","description":"æ‚è®°","author":"Sam","url":"https://acodetailor.github.io","root":"/"},"pages":[{"title":"404 Not Foundï¼šè¯¥é¡µæ— æ³•æ˜¾ç¤º","date":"2021-03-30T07:24:39.640Z","updated":"2021-03-30T07:24:39.640Z","comments":false,"path":"/404.html","permalink":"https://acodetailor.github.io/404.html","excerpt":"","text":""},{"title":"ä¹¦å•","date":"2021-03-30T07:24:39.645Z","updated":"2021-03-30T07:24:39.644Z","comments":false,"path":"books/index.html","permalink":"https://acodetailor.github.io/books/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2021-03-30T07:24:39.644Z","updated":"2021-03-30T07:24:39.643Z","comments":false,"path":"about/index.html","permalink":"https://acodetailor.github.io/about/index.html","excerpt":"","text":"ä¸ªäººè¯¦ç»†ä»‹ç»"},{"title":"åˆ†ç±»","date":"2021-03-30T07:24:39.645Z","updated":"2021-03-30T07:24:39.645Z","comments":false,"path":"categories/index.html","permalink":"https://acodetailor.github.io/categories/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2021-03-30T07:24:39.646Z","updated":"2021-03-30T07:24:39.646Z","comments":true,"path":"links/index.html","permalink":"https://acodetailor.github.io/links/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2021-03-30T07:24:39.647Z","updated":"2021-03-30T07:24:39.647Z","comments":false,"path":"repository/index.html","permalink":"https://acodetailor.github.io/repository/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2021-03-30T07:24:39.648Z","updated":"2021-03-30T07:24:39.648Z","comments":false,"path":"tags/index.html","permalink":"https://acodetailor.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"ç¼“å­˜ä¸€è‡´æ€§ç­–ç•¥","slug":"cache_consistent","date":"2022-05-22T07:32:35.712Z","updated":"2022-05-22T08:46:58.604Z","comments":false,"path":"2022/05/22/cache_consistent/","link":"","permalink":"https://acodetailor.github.io/2022/05/22/cache_consistent/","excerpt":"","text":"ä¸€ã€é—®é¢˜åœ¨å½“å‰äº’è”ç½‘ç³»ç»Ÿä¸­ï¼Œä¸ºäº†æé«˜å“åº”é€Ÿåº¦ï¼Œä½¿ç”¨ç¼“å­˜æ˜¯å¤§å®¶æœ€å¸¸ç”¨çš„æ‰‹æ®µã€‚ä½†æ˜¯ä½¿ç”¨ç¼“å­˜åå¿…ç„¶å¸¦æ¥äº†ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸‹è¾¹ä»è¯»å’Œæ”¹ä¸¤ä¸ªæ–¹é¢ï¼Œå°±å‡ ç§é€‰æ‹©åˆ†æä¸€ä¸‹å­˜åœ¨çš„é—®é¢˜ã€‚ äºŒã€Cache-Asideç­–ç•¥2.1 è¯»è¯»çš„è¯æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬éƒ½æ˜¯å…ˆè¯»å–ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå°†æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ï¼Œè¿”å›æ•°æ® 2.2 æ”¹æ–¹æ¡ˆâ‘ å…ˆæ”¹ç¼“å­˜ï¼Œå†æ”¹æ•°æ®åº“å¹¶å‘ä¿®æ”¹æ•°æ®æ—¶ï¼ŒAå…ˆä¿®æ”¹äº†ç¼“å­˜ï¼ŒBä¿®æ”¹äº†ç¼“å­˜ã€ä¿®æ”¹äº†æ•°æ®åº“ã€Aä¿®æ”¹æ•°æ®åº“ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚ æ–¹æ¡ˆâ‘¡å…ˆæ”¹æ•°æ®åº“ï¼Œå†æ”¹ç¼“å­˜å¹¶å‘æ—¶ä¹Ÿå­˜åœ¨ä¸Šè¿°é—®é¢˜ã€‚ æ–¹æ¡ˆâ‘¢å…ˆåˆ ç¼“å­˜ï¼Œå†æ”¹æ•°æ®åº“å¹¶å‘æ—¶Aè¯»ï¼ŒBæ”¹ï¼ŒBåˆ é™¤-&gt; A è¯»å–ï¼ˆæ›´æ–°äº†ç¼“å­˜ï¼‰-&gt; Bæ”¹æ•°æ®åº“ï¼Œé€ æˆä¸ä¸€è‡´ã€‚è¯»æ“ä½œæ­£å¸¸ä¼šæ¯”æ”¹å¿«ä¸€äº›ï¼Œé«˜å¹¶å‘ä¸‹è¿˜æ˜¯å®¹æ˜“å‡ºç°é—®é¢˜ã€‚ æ–¹æ¡ˆâ‘£å…ˆæ”¹æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜å¹¶å‘æ—¶ï¼ŒAè¯»ï¼ŒBæ”¹ã€‚ Aè¯» -&gt; Bæ”¹ -&gt; Båˆ  -&gt; A(æ›´æ–°)ã€‚é€ æˆä¸ä¸€è‡´ã€‚ æç«¯æ¡ä»¶ä¸‹ç¡®å®å­˜åœ¨è¯¥é—®é¢˜ï¼Œä½†æ˜¯è¯»æ­£å¸¸ä¼šæ¯”æ”¹ä»æ“ä½œå¿«ï¼Œæ»¡è¶³æ”¹é—®é¢˜å‡ºç°çš„æ¡ä»¶è¿˜æ˜¯æ¯”è¾ƒè‹›åˆ»ï¼Œæ‰€ä»¥ä¸€èˆ¬é€‰æ‹©è¯¥æ–¹æ¡ˆã€‚å‡è®¾åˆ é™¤ç¼“å­˜å¤±è´¥äº†å‘¢ï¼Œæš‚æ—¶ä¸è€ƒè™‘äº‹åŠ¡åœºæ™¯ã€‚å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¡¥å¿ï¼Œåˆ é™¤å¤±è´¥åå°†keyæ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œã€‚ ä¸‰ã€Read Throughå’ŒWrite Throughè¿™ç§æ–¹æ¡ˆå°†ç¼“å­˜ä½œä¸ºä¸»è¦æ•°æ®å­˜å‚¨ï¼Œç¼“å­˜æ•°æ®ä¸å­˜åœ¨è¿‡æœŸæ—¶é—´ã€‚ Read-Throughï¼Œåº”ç”¨æŸ¥è¯¢ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿”å›ï¼›ä¸å­˜åœ¨åˆ™ç”±ç¼“å­˜ç»„ä»¶å»æ•°æ®åº“åŠ è½½æ•°æ®ã€‚Write-Throughï¼Œå…ˆæŸ¥è¯¢è¦å†™å…¥çš„æ•°æ®åœ¨ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å…ˆæ›´æ–°ç¼“å­˜ç„¶åå†æ›´æ–°æ•°æ®åº“æœ€åè¿”å›ã€‚ é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œæ¯”è¾ƒç¼“å­˜ä¸­å­˜äº†æ‰€æœ‰æ•°æ®ã€‚ å››ã€Write BackWrite Backå’Œä¸Šè¿°çš„æ–¹æ¡ˆåŒºåˆ«åœ¨äºç¼“å­˜å’Œæ•°æ®åº“çš„åŒæ­¥é€šè¿‡å¼‚æ­¥æ–¹æ¡ˆæ¥å¤„ç†ã€‚","categories":[{"name":"DB","slug":"DB","permalink":"https://acodetailor.github.io/categories/DB/"}],"tags":[{"name":"cache","slug":"cache","permalink":"https://acodetailor.github.io/tags/cache/"}]},{"title":"ä½ çœŸçš„äº†è§£TCPå—","slug":"tcp","date":"2022-05-10T09:30:53.521Z","updated":"2022-05-15T13:02:51.416Z","comments":false,"path":"2022/05/10/tcp/","link":"","permalink":"https://acodetailor.github.io/2022/05/10/tcp/","excerpt":"","text":"0ã€å†™åœ¨ä¹‹å‰å‡†å¤‡ç»§ç»­å†™åšäº†ï¼Œèµ·å› æ˜¯çœ‹åˆ°ä¸€ä½å¹´è½»ä¸”æœ‰å®åŠ›çš„åšä¸»çš„ä¸€æ®µè¯ï¼Œå¤§ä½“æ„æ€å¦‚ä¸‹ï¼šå†™åšå®¢ä¸å¸Œæœ›å¤šå°‘äººèƒ½çœ‹åˆ°ï¼Œä½†æ˜¯å‡ åå¹´åè‡ªå·±èƒ½çœ‹çœ‹èµ°è¿‡çš„è·¯ä¹ŸæŒºå¥½ï¼Œç„¶åæ„Ÿè§‰è¢«ä»€ä¹ˆå‡»ä¸­äº†ã€‚ä¸ªäººå¹´å‰å·¥ä½œè¿›è¡Œäº†è°ƒæ•´ï¼ŒæŠ€æœ¯æ ˆæœ‰äº†å¾ˆå¤§çš„å˜åŒ–ï¼Œæ­£å¥½ä¹Ÿå¯ä»¥è®°å½•ä¸€ä¸‹å¯¹æ–°æŠ€æœ¯æ ˆçš„å­¦ä¹ ä½¿ç”¨è¿‡ç¨‹ã€‚ ä¸€ã€ä¸ºä»€ä¹ˆTCPå»ºè¿éœ€è¦ä¸‰æ¬¡è¿æ¥TCPä½œä¸ºå¸¸è§çš„é¢è¯•é¢˜ï¼Œå¤§å¤šæ•°ä¼šé—®é¢˜ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ã€time_waitã€close_waitçŠ¶æ€åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ã€‚æœ‰è€ƒè™‘è¿‡ä¸ºå•¥è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ â‘  TCPè¿æ¥æ˜¯ä»€ä¹ˆï¼Ÿå€Ÿç”¨ä¸€ä¸‹åˆ«äººçš„æ€»ç»“ï¼šTCPè¿æ¥æ˜¯ç”¨äºä¿è¯å¯é æ€§å’Œæµæ§åˆ¶æœºåˆ¶çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Socketã€åºåˆ—å·ä»¥åŠçª—å£å¤§å°ã€‚ â‘¡ å‡è®¾2æ¬¡æ¡æ‰‹å¦‚æœæ˜¯2æ¬¡æ¡æ‰‹ï¼Œclientç«¯å‘èµ·è¯·æ±‚ï¼Œä½†æ˜¯serverç«¯åªèƒ½é€‰æ‹©æ¥æ”¶æˆ–è€…æ‹’ç»ï¼Œå½“åœ¨ç½‘ç»œæ³¢åŠ¨æ—¶ï¼Œclientç«¯é‡å¤å‘é€è¯·æ±‚æ—¶ï¼Œserverç«¯å¦‚ä½•åˆ¤æ–­æ˜¯å†å²è¯·æ±‚è¿˜æ˜¯å½“å‰è¯·æ±‚å‘¢ï¼Ÿå½“ä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥å¹¶åœ¨è¿æ¥å¼•å…¥äº† RST è¿™ä¸€æ§åˆ¶æ¶ˆæ¯ï¼Œæ¥æ”¶æ–¹å½“æ”¶åˆ°è¯·æ±‚æ—¶ä¼šå°†å‘é€æ–¹å‘æ¥çš„ SEQ+1 å‘é€ç»™å¯¹æ–¹ï¼Œè¿™æ—¶ç”±å‘é€æ–¹æ¥åˆ¤æ–­å½“å‰è¿æ¥æ˜¯å¦æ˜¯å†å²è¿æ¥ï¼šå¦‚æœå½“å‰è¿æ¥æ˜¯å†å²è¿æ¥ï¼Œå³ SEQ è¿‡æœŸæˆ–è€…è¶…æ—¶ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±ä¼šç›´æ¥å‘é€ RST æ§åˆ¶æ¶ˆæ¯ä¸­æ­¢è¿™ä¸€æ¬¡è¿æ¥ï¼›å¦‚æœå½“å‰è¿æ¥ä¸æ˜¯å†å²è¿æ¥ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±ä¼šå‘é€ ACK æ§åˆ¶æ¶ˆæ¯ï¼Œé€šä¿¡åŒæ–¹å°±ä¼šæˆåŠŸå»ºç«‹è¿æ¥ï¼› â‘¢ å‡è®¾å››æ¬¡æ¡æ‰‹å››æ¬¡æ¡æ‰‹ï¼Œæ¯”å¦‚cientå‘é€synè¯·æ±‚ï¼Œserverå…ˆå›å¤ackç¡®è®¤åŒ…ï¼Œå†å‘é€synåŒ…ï¼Œæœ€åclientå†å‘é€ackåŒ…ï¼Œè¿™æ ·å››æ¬¡æ¡æ‰‹ä¹Ÿå¯ä»¥æ­£å¸¸å»ºè¿ã€‚å…¶å®è®¾è®¡è€…åœ¨è¿½æ±‚çš„å»ºç«‹è¿æ¥çš„æœ€å°‘æ¬¡æ•°ï¼Œå› ä¸ºæ€»å¯ä»¥ä½¿ç”¨æ›´å¤šçš„æ¬¡æ•°æ¥äº¤æ¢ç›¸åŒçš„ä¿¡æ¯ã€‚ äºŒã€æ¡æ‰‹æ—¶çš„å¼‚å¸¸æƒ…å†µâ‘  clientçš„ç¬¬ä¸€ä¸ªsynåŒ…ä¸¢äº†å¦‚æœå®¢æˆ·ç«¯ç¬¬ä¸€ä¸ªSYNåŒ…ä¸¢äº†ï¼ŒTCP åè®®ä¸­ï¼ŒæŸç«¯çš„åœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œåªè¦æ²¡æœ‰æ”¶åˆ°åº”ç­”çš„åŒ…ï¼Œæ— è®ºæ˜¯è¯·æ±‚åŒ…å¯¹æ–¹æ²¡æœ‰æ”¶åˆ°ï¼Œè¿˜æ˜¯å¯¹æ–¹çš„åº”ç­”åŒ…è‡ªå·±æ²¡æœ‰æ”¶åˆ°ï¼Œå‡è®¤å®šä¸ºæ˜¯ä¸¢åŒ…äº†ï¼Œä¼šè§¦å‘è¶…æ—¶é‡ä¼ æœºåˆ¶ã€‚æ‰€ä»¥æ­¤æ—¶ä¼šé‡ä¼ SYNåŒ…ã€‚æ ¹æ®ã€ŠTCP/IPè¯¦è§£å·â… ï¼šåè®®ã€‹ä¸­çš„æè¿°ï¼Œä¼šå°è¯•ä¸‰æ¬¡ï¼Œé—´éš”æ—¶é—´åˆ†åˆ«æ˜¯ 5.8sã€24sã€48sï¼Œæ€»çš„å°è¯•æ—¶é—´æ˜¯ 75sã€‚ â‘¡ serverå›å¤çš„syn+ackåŒ…ä¸¢äº†æ­¤æ—¶æœåŠ¡ç«¯å·²ç»æ”¶åˆ°äº†æ•°æ®åŒ…å¹¶å›å¤ï¼Œå¦‚æœè¿™ä¸ªåŒ…ä¸¢äº†ï¼Œå¦‚ç¬¬ä¸€æ­¥è¯´çš„ï¼Œclientä¼šè®¤ä¸ºè‡ªå·±çš„synåŒ…ä¸¢äº†ï¼Œclientå°±ä¼šç»§ç»­é‡ä¼ ã€‚serverç«¯åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„ackåŒ…ï¼Œä¹Ÿä¼šè§¦å‘é‡ä¼ ï¼Œæ­¤æ—¶serverå¤„äº SYN_RCVD çŠ¶æ€ï¼Œä¼šä¾æ¬¡ç­‰å¾… 3sã€6sã€12s åï¼Œé‡æ–°å‘é€SYN,ACKåŒ…ã€‚è€Œè¿™ä¸ªé‡ä¼ æ¬¡æ•°ï¼Œlinuxä¸‹å¯ä»¥é€šè¿‡ tcp_synack_retries è¿›è¡Œé…ç½®ï¼Œé»˜è®¤å€¼ä¸º 5ã€‚å¦‚æœè¿™ä¸ªé‡è¯•æ¬¡æ•°å†…ï¼Œä»æœªæ”¶åˆ°ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ä¼šè‡ªåŠ¨å…³é—­è¿™ä¸ªè¿æ¥ã€‚åŒæ—¶ç”±äºclientä¹Ÿä¼šè¿›è¡Œé‡ä¼ ï¼Œserveræ”¶åˆ°åï¼Œä¼šç«‹å³é‡æ–°å‘é€SYN+ACKåŒ…ã€‚ â‘¢ clientçš„syn+ackåŒ…ä¸¢äº†å¦‚æœæœ€åä¸€ä¸ªåŒ…ä¸¢äº†ï¼Œserverå› ä¸ºæ”¶ä¸åˆ°èµ°é‡ä¼ æœºåˆ¶ï¼Œè€Œclient ESTABLISHED çŠ¶æ€ã€‚clientè¿›å…¥ ESTABLISHED çŠ¶æ€åï¼Œè®¤ä¸ºè¿æ¥å·²æˆåŠŸå»ºç«‹ï¼Œä¼šç«‹å³å‘é€æ•°æ®ã€‚ä½†æ˜¯æœåŠ¡ç«¯å› ä¸ºæ²¡æœ‰æ”¶åˆ°æœ€åä¸€ä¸ªACKåŒ…ï¼Œä¾ç„¶å¤„äº SYN-RCVD çŠ¶æ€ã€‚é‚£ä¹ˆserveræ”¶åˆ°äº†clientçš„åŒ…ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿå…¶å®å½“å®¢æˆ·ç«¯åœ¨ ESTABLISHED çŠ¶æ€ä¸‹ï¼Œå¼€å§‹å‘é€æ•°æ®åŒ…æ—¶ï¼Œä¼šæºå¸¦ä¸Šä¸€ä¸ªACKçš„ç¡®è®¤åºå·ï¼Œæ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹çš„æœ€åä¸€ä¸ªåŒ…ä¸¢äº†ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…æ—¶ï¼Œèƒ½å¤Ÿé€šè¿‡åŒ…å†… ACK çš„ç¡®è®¤åºå·ï¼Œæ­£å¸¸è¿›å…¥ ESTABLISHED çŠ¶æ€ ä¸‰ã€3æ¬¡æ¡æ‰‹æ—¶serverç«¯æœ‰syn_rcvdå’ŒESTABLISHEDçŠ¶æ€ï¼ŒçœŸå®åœºæ™¯ä¸‹ä¼šæœ‰å¾ˆå¤šè¿æ¥åŒæ—¶å»ºç«‹ï¼Œserverç«¯æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢åŠè¿æ¥é˜Ÿåˆ—ï¼ˆIncomplete connection queueï¼‰ï¼Œåˆç§° SYN é˜Ÿåˆ—å…¨è¿æ¥é˜Ÿåˆ—ï¼ˆCompleted connection queueï¼‰ï¼Œåˆç§° Accept é˜Ÿåˆ— å½“å®¢æˆ·ç«¯å‘èµ· SYN åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ä»¥åä¼šå› ACK å’Œè‡ªå·±çš„ SYNã€‚è¿™æ—¶æœåŠ¡ç«¯è¿™è¾¹çš„ TCP ä» listen çŠ¶æ€å˜ä¸º SYN_RCVD (SYN Received)ï¼Œæ­¤æ—¶ä¼šå°†è¿™ä¸ªè¿æ¥ä¿¡æ¯æ”¾å…¥åŠè¿æ¥é˜Ÿåˆ—ï¼ŒåŠè¿æ¥é˜Ÿåˆ—ä¹Ÿè¢«ç§°ä¸º SYN Queueã€‚æœåŠ¡ç«¯å›å¤ SYN+ACK åŒ…ä»¥åç­‰å¾…å®¢æˆ·ç«¯å›å¤ ACKï¼ŒåŒæ—¶å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœè¶…æ—¶è¿˜æœªæ”¶åˆ° ACK ä¼šè¿›è¡Œ SYN+ACK çš„é‡ä¼ ï¼Œé‡ä¼ çš„æ¬¡æ•°ç”± tcp_synack_retrieså€¼ç¡®å®šï¼ˆå’Œä¸Šè¾¹è¯´çš„å¯¹ä¸Šäº†ï¼‰ã€‚ä¸€æ—¦æ”¶åˆ°å®¢æˆ·ç«¯çš„ ACKï¼ŒæœåŠ¡ç«¯å°±å¼€å§‹å°è¯•æŠŠå®ƒåŠ å…¥å¦å¤–ä¸€ä¸ªå…¨è¿æ¥é˜Ÿåˆ—ï¼ˆAccept Queueï¼‰ã€‚åŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°ä¸ä¸‰ä¸ªå€¼æœ‰å…³ï¼šç”¨æˆ·å±‚ listen ä¼ å…¥çš„backlogç³»ç»Ÿå˜é‡ net.ipv4.tcp_max_syn_backlogï¼Œé»˜è®¤å€¼ä¸º 128ç³»ç»Ÿå˜é‡ net.core.somaxconnï¼Œé»˜è®¤å€¼ä¸º 128 å…¨è¿æ¥é˜Ÿåˆ—åŒ…å«äº†æœåŠ¡ç«¯æ‰€æœ‰å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹ï¼Œä½†æ˜¯è¿˜æœªè¢«åº”ç”¨è°ƒç”¨ accept å–èµ°çš„è¿æ¥é˜Ÿåˆ—ã€‚æ­¤æ—¶çš„ socket å¤„äº ESTABLISHED çŠ¶æ€ã€‚æ¯æ¬¡åº”ç”¨è°ƒç”¨ accept() å‡½æ•°ä¼šç§»é™¤é˜Ÿåˆ—å¤´çš„è¿æ¥ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œaccept() é€šå¸¸ä¼šé˜»å¡ã€‚å…¨è¿æ¥é˜Ÿåˆ—ä¹Ÿè¢«ç§°ä¸º Accept é˜Ÿåˆ—ã€‚TCP å…¨è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ç”± min(somaxconn, backlog) æ§åˆ¶ï¼Œå…¶ä¸­ï¼šsomaxconn æ˜¯ Linux å†…æ ¸å‚æ•°ï¼Œç”± /proc/sys/net/core/somaxconn æŒ‡å®šbacklog æ˜¯ TCP åè®®ä¸­ listen å‡½æ•°çš„å‚æ•°ä¹‹ä¸€ï¼Œå³ int listen(int sockfd, int backlog) å‡½æ•°ä¸­çš„ backlog å¤§å°ã€‚åœ¨ Golang ä¸­ï¼Œlisten çš„ backlog å‚æ•°ä½¿ç”¨çš„æ˜¯ /proc/sys/net/core/somaxconn æ–‡ä»¶ä¸­çš„å€¼ã€‚ backlogæ—¢ç„¶å†³å®šäº†é˜Ÿåˆ—çš„é•¿åº¦ï¼Œé‚£åœ¨æˆ‘ä»¬ä¼˜åŒ–å¹¶å‘çš„å¤„ç†ä¸Šå¯ä»¥é€šè¿‡ä»–è¿›è¡Œè°ƒä¼˜ï¼ŒTomcatã€nginxã€redisç­‰éƒ½ç”¨åˆ°äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥æœæœã€‚é‡åˆ°åŠè¿æ¥ã€å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºæŸ¥çœ‹å‘½ä»¤å’Œå›æ˜¾ 123$ netstat -s | grep -i &quot;listen&quot; 189088 times the listen queue of a socket overflowed 30140232 SYNs to LISTEN sockets dropped å››ã€é…ä¸ªå›¾ (ç½‘ä¸Šå¤åˆ¶çš„)","categories":[{"name":"network","slug":"network","permalink":"https://acodetailor.github.io/categories/network/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://acodetailor.github.io/tags/Linux/"}]},{"title":"Knative","slug":"knativeæºç ä¸€","date":"2021-09-22T03:25:42.493Z","updated":"2021-09-25T15:05:42.758Z","comments":false,"path":"2021/09/22/knativeæºç ä¸€/","link":"","permalink":"https://acodetailor.github.io/2021/09/22/knative%E6%BA%90%E7%A0%81%E4%B8%80/","excerpt":"","text":"ä¸€ã€Knativeæ˜¯ä»€ä¹ˆKnativeåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼ŒServingã€Eventingã€Buildingã€‚Servingï¼šä¸»è¦ä½¿ç”¨Knative Serviceéƒ¨ç½²åº”ç”¨ï¼Œå…·æœ‰å¼¹æ€§ä¼¸ç¼©ç­‰åŠŸèƒ½ã€‚Eventingï¼šäº‹ä»¶é©±åŠ¨ï¼Œé€šè¿‡å…¶ä»–å†…ç½®çš„èµ„æºï¼Œå®ç°äº‹ä»¶çš„å¼‚æ­¥æµè½¬ã€‚Buildingï¼šé•œåƒæ„å»ºã€‚ äºŒã€Servingæ¶æ„ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªKnativeçš„Serviceèµ„æºæ—¶ï¼ŒKnativeçš„controllerä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬åˆ›å»ºå¦‚å›¾æ‰€ç¤ºçš„èµ„æºï¼Œå®ç°Servingç»„ä»¶çš„ç›¸å…³åŠŸèƒ½ã€‚ åç»­è¯¦ç»†åˆ†æå„ä¸ªcontrollerä»£ç ã€‚","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"knative","slug":"knative","permalink":"https://acodetailor.github.io/tags/knative/"}]},{"title":"Camelk","slug":"camel","date":"2021-09-13T15:46:34.407Z","updated":"2021-09-22T03:25:42.493Z","comments":false,"path":"2021/09/13/camel/","link":"","permalink":"https://acodetailor.github.io/2021/09/13/camel/","excerpt":"","text":"ä¸€ã€ç®€ä»‹Camelè¿™ä¸ªè¯æƒ³å¿…å¾ˆå¤šjavaçš„å¼€å‘è€…éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„é›†æˆæ¡†æ¶ï¼Œå¯ä»¥é€šè¿‡å®ƒå¿«é€Ÿçš„ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç»„ä»¶ã€è°ƒç”¨å…¶ä»–ç³»ç»Ÿçš„æ¥å£ã€‚è¿™ç¯‡æ–‡ç« è¦ä»‹ç»çš„camelkï¼Œå…¶å®æ˜¯Camel+Knativeçš„ç»„åˆã€‚é€šè¿‡CRDå°†Camelçš„ç»„ä»¶å°è£…æˆk8sé›†ç¾¤çš„èµ„æºï¼ŒCRD Controlleråˆ›å»ºKnativeçš„Serviceèµ„æºï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨åˆ°Knativeå¸¦æ¥çš„å¼¹æ€§ä¼¸ç¼©ã€äº‹ä»¶é©±åŠ¨ç­‰æŠ€æœ¯ä¼˜ç‚¹ã€‚ äºŒã€ä½¿ç”¨ä¸‹é¢ä½¿ç”¨ä¸€ä¸ªä¾‹å­æ¥è¿›è¡Œç®€å•ä»‹ç»ã€‚éœ€æ±‚:é€šè¿‡restæ¥å£æä¾›æ•°æ®åº“è¡¨çš„æŸ¥è¯¢ã€‚å®ç°:å»¶ä¼¸:å®ç°è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¹Ÿä¸éœ€è¦é‡æ–°æ„å»ºå‘å¸ƒã€‚å»¶ä¼¸çœ‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å¿«é€Ÿå®ç°æ•°æ®é›†æˆã€æœåŠ¡æš´éœ²ç­‰éœ€æ±‚ã€‚ ä¸‰ã€æ¶æ„","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"oom","slug":"oom","permalink":"https://acodetailor.github.io/tags/oom/"}]},{"title":"Serverlessä¹‹Knative","slug":"serverless-istio","date":"2021-05-16T12:59:42.740Z","updated":"2021-05-16T13:48:47.655Z","comments":false,"path":"2021/05/16/serverless-istio/","link":"","permalink":"https://acodetailor.github.io/2021/05/16/serverless-istio/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯Knativeknative æ˜¯è°·æ­Œç‰µå¤´çš„ serverless æ¶æ„æ–¹æ¡ˆï¼Œæ—¨åœ¨æä¾›ä¸€å¥—ç®€å•æ˜“ç”¨çš„ serverless å¼€æºæ–¹æ¡ˆï¼ŒæŠŠ serverless æ ‡å‡†åŒ–å’Œå¹³å°åŒ–ã€‚ç›®å‰å‚ä¸ knative é¡¹ç›®çš„å…¬å¸ä¸»è¦æœ‰ï¼š Googleã€Pivotalã€IBMã€Red Hatå’ŒSAPã€‚ è¿™æ˜¯ Google Cloud Platform å®£å¸ƒ knative æ—¶ç»™å‡ºçš„ä»‹ç»ï¼šDeveloped in close partnership with Pivotal, IBM, Red Hat, and SAP, Knative pushes Kubernetes-based computing forward by providing the building blocks you need to build and deploy modern, container-based serverless applications.ä¸Pivotalï¼ŒIBMï¼ŒRed Hatå’ŒSAPå¯†åˆ‡åˆä½œå¼€å‘ï¼Œé€šè¿‡æä¾›æ„å»ºå’Œéƒ¨ç½²åŸºäºå®¹å™¨çš„ç°ä»£serverlessåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ„å»ºå—ï¼ŒKnativeæ¨åŠ¨åŸºäºKubernetesçš„è®¡ç®—ã€‚ åœ¨knativeçš„githubé¡µé¢ï¼ŒKnative ç»™å‡ºçš„å®˜æ–¹ä»‹ç»å¦‚ä¸‹ï¼šKubernetes-based platform to build, deploy, and manage modern serverless workloads.åŸºäºKubernetesçš„å¹³å°ï¼Œç”¨äºæ„å»ºï¼Œéƒ¨ç½²å’Œç®¡ç†ç°ä»£serverlesså·¥ä½œè´Ÿè½½ã€‚ äºŒã€Knativeæ¦‚è¿°Knativeæ‰©å±•äº†Kubernetesï¼Œæä¾›äº†ä¸€ç»„ä¸­é—´ä»¶ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯¹äºæ„å»ºå¯åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œçš„ç°ä»£ä»¥æºä¸ºä¸­å¿ƒå’ŒåŸºäºå®¹å™¨çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ï¼šåœ¨æœ¬åœ°ï¼Œåœ¨äº‘ä¸­ï¼Œç”šè‡³åœ¨ç¬¬ä¸‰æ–¹æ•°æ®ä¸­å¿ƒã€‚ Knativeé¡¹ç›®ä¸‹çš„æ¯ä¸ªç»„ä»¶éƒ½å°è¯•è¯†åˆ«å¸¸è§æ¨¡å¼å¹¶ç¼–çº‚æœ€ä½³å®è·µï¼Œè¿™äº›æœ€ä½³å®è·µè¢«çœŸå®ä¸–ç•Œä¸­åŸºäºKubernetesçš„æˆåŠŸæ¡†æ¶å’Œåº”ç”¨ç¨‹åºå…±äº«ã€‚ Knativeç»„ä»¶ä¸“æ³¨äºè§£å†³è®¸å¤šå¹³å‡¡ä½†å›°éš¾çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š éƒ¨ç½²å®¹å™¨ åœ¨Kubernetesä¸Šç¼–æ’source-to-URLçš„å·¥ä½œæµç¨‹ ä½¿ç”¨è“ç»¿éƒ¨ç½²è·¯ç”±å’Œç®¡ç†æµé‡ æ ¹æ®éœ€æ±‚è‡ªåŠ¨æ”¶ç¼©å’Œè°ƒæ•´å·¥ä½œè´Ÿè½½å¤§å° å°†è¿è¡ŒæœåŠ¡ç»‘å®šåˆ°äº‹ä»¶ç”Ÿæ€ç³»ç»Ÿ Knativeçš„å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ä¹ è¯­ï¼Œè¯­è¨€å’Œæ¡†æ¶æ¥éƒ¨ç½²ä»»ä½•å·¥ä½œè´Ÿè½½ï¼šå‡½æ•°ï¼Œåº”ç”¨ç¨‹åºæˆ–å®¹å™¨ã€‚ ç»„ä»¶ Build - æºåˆ°å®¹å™¨çš„æ„å»ºç¼–æ’ Eventing - ç®¡ç†å’Œäº¤ä»˜äº‹ä»¶ Serving - è¯·æ±‚é©±åŠ¨çš„è®¡ç®—ï¼Œå¯ä»¥æ‰©å±•åˆ°é›¶ å—ä¼— å¼€å‘äººå‘˜Knativeç»„ä»¶ä¸ºå¼€å‘äººå‘˜æä¾›KubernetesåŸç”ŸAPIï¼Œç”¨äºå°†serverlessé£æ ¼çš„å‡½æ•°ï¼Œåº”ç”¨ç¨‹åºå’Œå®¹å™¨éƒ¨ç½²åˆ°è‡ªåŠ¨ä¼¸ç¼©è¿è¡Œæ—¶ã€‚ è¿ç»´Knativeç»„ä»¶æ—¨åœ¨é›†æˆåˆ°æ›´åŠ ä¼˜é›…çš„äº§å“ä¸­ï¼Œäº‘æœåŠ¡æä¾›å•†æˆ–å¤§å‹ä¼ä¸šçš„å†…éƒ¨å›¢é˜Ÿå¯ä»¥éšåè¿ç»´ã€‚ ä»»ä½•ä¼ä¸šæˆ–äº‘æä¾›å•†éƒ½å¯ä»¥å°†Knativeç»„ä»¶åº”ç”¨åˆ°ä»–ä»¬è‡ªå·±çš„ç³»ç»Ÿä¸­ï¼Œå¹¶å°†è¿™äº›æ”¶ç›Šä¼ é€’ç»™ä»–ä»¬çš„å®¢æˆ·ã€‚ Knativeæ˜¯ä¸€ä¸ªå¤šå…ƒåŒ–ï¼Œå¼€æ”¾å’ŒåŒ…å®¹çš„ç¤¾åŒºã€‚ ä¸‰ã€Knativeä¼˜åŠ¿å’Œå·²æœ‰çš„FaaS/serverlesså®ç°ä¸åŒï¼Œknativeåœ¨äº§å“è§„åˆ’å’Œè®¾è®¡ç†å¿µä¸Šæœ‰å¸¦æ¥æ–°ä¸œè¥¿ï¼š å·¥ä½œè´Ÿè½½ç±»å‹å’Œæ ‡å‡†åŒ–çš„ FaaS ä¸åŒï¼Œknative æœŸæœ›èƒ½å¤Ÿè¿è¡Œæ‰€æœ‰çš„ workload : traditional application function container é’ˆå¯¹å¸¸è§åº”ç”¨ç”¨ä¾‹æä¾›æ›´é«˜çº§åˆ«æŠ½è±¡çš„èšç„¦APIã€‚ åœ¨å‡ ç§’é’Ÿå†…å³å¯æä¾›å¯æ‰©å±•ï¼Œå®‰å…¨ï¼Œæ— çŠ¶æ€çš„æœåŠ¡ã€‚ æ¾è€¦åˆç‰¹æ€§å¯ä»¥æŒ‰éœ€ä½¿ç”¨ç»„ä»¶ å¯æ’æ‹”ç»„ä»¶ï¼Œå¯ä»¥è‡ªå¤‡æ—¥å¿—å’Œç›‘æ§ï¼Œç½‘ç»œå’ŒæœåŠ¡ç½‘æ ¼ã€‚Knativeæ˜¯å¯ç§»æ¤çš„ï¼šå¯è¿è¡ŒäºKubernetesè¿è¡Œçš„ä»»ä½•åœ°æ–¹ï¼Œä¸ç”¨æ‹…å¿ƒä¾›åº”å•†é”å®šã€‚knative å»ºç«‹åœ¨ kubernetes å’Œ istio ä¹‹ä¸Š ä½¿ç”¨ kubernetes æä¾›çš„å®¹å™¨ç®¡ç†èƒ½åŠ›ï¼ˆdeploymentã€replicasetã€å’Œ podsç­‰ï¼‰ï¼Œä»¥åŠ istio æä¾›çš„ç½‘ç»œç®¡ç†åŠŸèƒ½ï¼ˆingressã€LBã€dynamic routeç­‰ï¼‰ã€‚ éœ€è¦ç‰¹åˆ«å¼ºè°ƒçš„æ˜¯ï¼šknative æ˜¯ Kubernetes-basedï¼ æˆ–è€…è¯´ Kubernetes-onlyï¼Œä»…ä»…è¿è¡Œäºk8så¹³å°ã€‚","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"}]},{"title":"Serverlessä¹‹Knativeæµé‡è½¬å‘","slug":"knative","date":"2021-04-30T01:40:25.368Z","updated":"2021-05-18T07:26:34.581Z","comments":false,"path":"2021/04/30/knative/","link":"","permalink":"https://acodetailor.github.io/2021/04/30/knative/","excerpt":"","text":"å‰è¾¹è¯´è¿‡Knativeæ˜¯åŸºäºK8séƒ¨ç½²çš„ï¼Œä½¿ç”¨k8sçš„å®¹å™¨ç®¡ç†åŠŸèƒ½ä»¥åŠistioçš„ç½‘ç»œç®¡ç†åŠŸèƒ½ï¼Œä¸‹è¾¹ä¸€èµ·çœ‹ä¸€ä¸‹Knativeçš„æµé‡æ˜¯æ€ä¹ˆè½¬å‘çš„å§ã€‚ ä¸€ã€Knativeèµ„æºä»‹ç»Knativeèµ„æºknativeä¸»è¦åˆ†ä¸ºä¸‰ä¸ªç»„ä»¶ï¼Œbuildã€serverã€eventï¼Œåˆ†åˆ«å¤„ç†CI/CD,æœåŠ¡ä¼¸ç¼©ï¼Œäº‹ä»¶é©±åŠ¨ã€‚æµé‡è½¬å‘ä¸»è¦ç”±serverè¿™éƒ¨åˆ†å¤„ç†ã€‚ knative service knative ingress knative serverlessService knative route knative configuration kantive revision istioèµ„æº Gateway virtualServiceã€‚ äºŒã€æµé‡è½¬å‘å®˜æ–¹æ¶æ„å…ˆå›é¡¾ä¸€ä¸‹Knativeå®˜æ–¹çš„ä¸€ä¸ªç®€å•çš„åŸç†ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚ç”¨æˆ·åˆ›å»ºä¸€ä¸ªKnative Serviceï¼ˆksvcï¼‰åï¼ŒKnativeä¼šè‡ªåŠ¨åˆ›å»ºRouteï¼ˆrouteï¼‰ã€Configurationï¼ˆcfgï¼‰èµ„æºï¼Œç„¶åcfgä¼šåˆ›å»ºå¯¹åº”çš„Revisionï¼ˆrevï¼‰ç‰ˆæœ¬ã€‚revå®é™…ä¸Šåˆä¼šåˆ›å»ºDeploymentæä¾›æœåŠ¡ï¼Œæµé‡æœ€ç»ˆä¼šæ ¹æ®routeçš„é…ç½®ï¼Œå¯¼å…¥åˆ°ç›¸åº”çš„revä¸­ã€‚ è€ç‰ˆæœ¬ï¼ˆ0.6ï¼‰åœ¨é›†æˆä½¿ç”¨Istioéƒ¨ç½²æ—¶ï¼ŒRouteé»˜è®¤é‡‡ç”¨çš„æ˜¯Istio Ingress Gatewayå®ç°ï¼Œå¤§æ¦‚åœ¨Knative 0.6ç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒRouteçš„æµé‡è½¬å‘æœ¬è´¨ä¸Šæ˜¯ç”±Istio virtualserviceï¼ˆvsï¼‰æ§åˆ¶ã€‚å‰¯æœ¬æ•°ä¸º0æ—¶ï¼Œå…¶ä¸­destinationæŒ‡å‘çš„æ˜¯Activatorç»„ä»¶ã€‚æ­¤æ—¶Activatorä¼šå¸®åŠ©è½¬å‘å†·å¯åŠ¨æ—¶çš„è¯·æ±‚ã€‚ 12345678910111213141516171819apiVersion: networking.istio.io/v1alpha3kind: VirtualServicemetadata: name: route-f8c50d56-3f47-11e9-9a9a-08002715c9e6spec: gateways: - knative-ingress-gateway - mesh hosts: - helloworld-go.default.example.com - helloworld-go.default.svc.cluster.local http: - appendHeaders: route: - destination: host: Activator-Service.knative-serving.svc.cluster.local port: number: 80 weight: 100 å½“æœåŠ¡å¯åŠ¨åï¼Œä¿®æ”¹vså°†destinationæŒ‡å‘å¯¹åº”æœåŠ¡å®ä¾‹ä¸Šã€‚ 12345678910111213141516apiVersion: networking.istio.io/v1alpha3kind: VirtualServicemetadata: name: uns route-f8c50d56-3f47-11e9-9a9a-08002715c9e6spec: hosts: - helloworld-go.default.example.com - helloworld-go.default.svc.cluster.local http: - match: route: - destination: host: helloworld-go-2xxcn-Service.default.svc.cluster.local port: number: 80 weight: 100 æ–°ç‰ˆæœ¬æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„hello-go ksvcï¼Œå¹¶ä»¥æ­¤è¿›è¡Œåˆ†æã€‚ksvcå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213apiVersion: serving.knative.dev/v1alpha1kind: Servicemetadata: name: hello-go namespace: faasspec: template: spec: containers: - image: harbor-yx-jd-dev.yx.netease.com/library/helloworld-go:v0.1 env: - name: TARGET value: &quot;Go Sample v1&quot; virtualserviceçš„å˜åŒ–ç¯å¢ƒæ˜¯ä¸€ä¸ªæ ‡å‡†çš„Istioéƒ¨ç½²ï¼ŒServerlessç½‘å…³ä¸ºIstio Ingress Gatewayï¼Œæ‰€ä»¥åˆ›å»ºå®Œksvcåï¼Œä¸ºäº†éªŒè¯æœåŠ¡æ˜¯å¦å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œéœ€è¦å‘é€httpè¯·æ±‚è‡³ç½‘å…³ã€‚Gatewayèµ„æºå·²ç»åœ¨éƒ¨ç½²Knativeçš„æ—¶å€™åˆ›å»ºï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒvsã€‚åœ¨æœåŠ¡å‰¯æœ¬æ•°ä¸º0çš„æ—¶å€™ï¼ŒKnativeæ§åˆ¶å™¨åˆ›å»ºçš„vså…³é”®é…ç½®å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728spec: gateways: - knative-serving/cluster-local-gateway - knative-serving/knative-ingress-gateway hosts: - hello-go.faas - hello-go.faas.example.com - hello-go.faas.svc - hello-go.faas.svc.cluster.local - f81497077928a654cf9422088e7522d5.probe.invalid http: - match: - authority: regex: ^hello-go\\.faas\\.example\\.com(?::\\d&#123;1,5&#125;)?$ gateways: - knative-serving/knative-ingress-gateway - authority: regex: ^hello-go\\.faas(\\.svc(\\.cluster\\.local)?)?(?::\\d&#123;1,5&#125;)?$ gateways: - knative-serving/cluster-local-gateway retries: attempts: 3 perTryTimeout: 10m0s route: - destination: host: hello-go-fpmln.faas.svc.cluster.local port: number: 80 vsæŒ‡å®šäº†å·²ç»åˆ›å»ºå¥½çš„gwï¼ŒåŒæ—¶destinationæŒ‡å‘çš„æ˜¯ä¸€ä¸ªServiceåŸŸåã€‚è¿™ä¸ªServiceå°±æ˜¯Knativeé»˜è®¤è‡ªåŠ¨åˆ›å»ºçš„hello-goæœåŠ¡çš„Serviceã€‚å¯ä»¥å‘ç°vsçš„ownerReferencesæŒ‡å‘äº†ä¸€ä¸ªKnativeçš„CRD ingress.networking.internal.knative.devï¼š 1234567ownerReferences:- apiVersion: networking.internal.knative.dev/v1alpha1 blockOwnerDeletion: true controller: true kind: Ingress name: hello-go uid: 4a27a69e-5b9c-11ea-ae53-fa163ec7c05f æ ¹æ®åå­—å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªKnativeå†…éƒ¨ä½¿ç”¨çš„CRDï¼Œè¯¥CRDçš„å†…å®¹å…¶å®å’Œvsæ¯”è¾ƒç±»ä¼¼ï¼ŒåŒæ—¶ingress.networking.internal.knative.devçš„ownerReferencesæŒ‡å‘äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„routeï¼Œæ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼šroute -&gt; kingress(ingress.networking.internal.knative.dev) -&gt; vsåœ¨ç½‘å…³è¿™ä¸€å±‚æ¶‰åŠåˆ°çš„CRDèµ„æºå°±æ˜¯å¦‚ä¸Šè¿™äº›ã€‚è¿™é‡Œkingressçš„æ„ä¹‰åœ¨äºå¢åŠ ä¸€å±‚æŠ½è±¡ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…¶ä»–ç½‘å…³ï¼Œåˆ™ä¼šå°†kingressè½¬æ¢æˆç›¸åº”çš„ç½‘å…³èµ„æºé…ç½®ã€‚æœ€æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œè´Ÿè´£kingressåˆ°Istio vsçš„æ§åˆ¶å™¨éƒ¨åˆ†ä»£ç å·²ç»ç‹¬ç«‹å‡ºä¸€ä¸ªé¡¹ç›®ï¼Œå¯è§å¦‚ä»Šçš„Knativeå¯¹Istioå·²ç»ä¸æ˜¯å¼ºä¾èµ–ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°Serverlessç½‘å…³æ˜¯ç”±Knativeæ§åˆ¶å™¨æœ€ç»ˆç”Ÿæˆçš„vsç”Ÿæ•ˆåˆ°Istio Ingress Gatewayä¸Šï¼Œä¸ºäº†éªŒè¯æˆ‘ä»¬åˆšæ‰éƒ¨ç½²çš„æœåŠ¡æ˜¯å¦å¯ä»¥æ­£å¸¸çš„è¿è¡Œï¼Œç®€å•çš„ç”¨curlå‘½ä»¤è¯•éªŒä¸€ä¸‹ã€‚ å’Œæ‰€æœ‰çš„ç½‘å…³æˆ–è€…è´Ÿè½½å‡è¡¡å™¨ä¸€æ ·ï¼Œå¯¹äº7å±‚httpè®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Headeré‡ŒåŠ åŸŸåHostï¼Œç”¨äºæµé‡è½¬å‘åˆ°å…·ä½“çš„æœåŠ¡ã€‚åœ¨ä¸Šé¢çš„vsä¸­å·²ç»å¯ä»¥çœ‹åˆ°å¯¹å¤–åŸŸåå’Œå†…éƒ¨ServiceåŸŸåå‡å·²ç»é…ç½®ã€‚æ‰€ä»¥ï¼Œåªéœ€è¦ï¼š 1curl -v -H&#x27;Host:hello-go.faas.example.com&#x27; &lt;IngressIP&gt;:&lt;Port&gt; å…¶ä¸­ï¼ŒIngressIPå³ç½‘å…³å®ä¾‹å¯¹å¤–æš´éœ²çš„IPã€‚ å¯¹äºå†·å¯åŠ¨æ¥è¯´ï¼Œç›®å‰çš„Knativeéœ€è¦ç­‰åå‡ ç§’ï¼Œå³ä¼šæ”¶åˆ°è¯·æ±‚ã€‚æ ¹æ®ä¹‹å‰è€ç‰ˆæœ¬çš„ç»éªŒï¼Œè¿™ä¸ªæ—¶å€™vsä¼šè¢«æ›´æ–°ï¼ŒdestinationæŒ‡å‘hello-goçš„Serviceã€‚ ä¸è¿‡ï¼Œç°åœ¨æˆ‘ä»¬å®é™…å‘ç°ï¼Œvsæ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œä»ç„¶æŒ‡å‘äº†æœåŠ¡çš„Serviceã€‚å¯¹æ¯”è€ç‰ˆæœ¬ä¸­æœåŠ¡å‰¯æœ¬æ•°ä¸º0æ—¶ï¼Œå…¶å®vsçš„destinationæŒ‡å‘çš„æ˜¯Activatorç»„ä»¶çš„ã€‚ä½†ç°åœ¨ï¼Œä¸ç®¡æœåŠ¡å‰¯æœ¬æ•°å¦‚ä½•å˜åŒ–ï¼Œvsä¸€ç›´ä¸å˜ã€‚ è¹Šè··åªèƒ½ä»destinationçš„ServiceåŸŸåå…¥æ‰‹ã€‚ revision serviceæ¢ç´¢åˆ›å»ºksvcåï¼ŒKnativeä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºServiceå¦‚ä¸‹æ‰€ç¤ºã€‚ 123456$ kubectl -n faas get svcNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) hello-go ExternalName &lt;none&gt; cluster-local-gateway.istio-system.svc.cluster.local &lt;none&gt; hello-go-fpmln ClusterIP 10.178.4.126 &lt;none&gt; 80/TCP hello-go-fpmln-m9mmg ClusterIP 10.178.5.65 &lt;none&gt; 80/TCP,8022/TCP hello-go-fpmln-metrics ClusterIP 10.178.4.237 &lt;none&gt; 9090/TCP,9091/TCP hello-go Serviceæ˜¯ä¸€ä¸ªExternalName Serviceï¼Œä½œç”¨æ˜¯å°†hello-goçš„ServiceåŸŸåå¢åŠ ä¸€ä¸ªdns CNAMEåˆ«åè®°å½•ï¼ŒæŒ‡å‘ç½‘å…³çš„ServiceåŸŸåã€‚ æ ¹æ®Serviceçš„annotationæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒKnativeå¯¹hello-go-fpmlnã€hello-go-fpmln-m9mmg ã€hello-go-fpmln-metricsè¿™ä¸‰ä¸ªServiceçš„å®šä½åˆ†åˆ«ä¸ºpublic Serviceã€private Serviceå’Œmetric Serviceï¼ˆæœ€æ–°ç‰ˆæœ¬å·²ç»å°†privateå’Œmetrics Serviceåˆå¹¶ï¼‰ã€‚ private Serviceå’Œmetric Serviceå…¶å®ä¸éš¾ç†è§£ã€‚é—®é¢˜çš„å…³é”®å°±åœ¨è¿™é‡Œçš„public Serviceï¼Œä»”ç»†ç ”ç©¶hello-go-fpmln Serviceï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰labelSelectorçš„Serviceï¼Œå®ƒçš„Endpointä¸æ˜¯kubernetesè‡ªåŠ¨åˆ›å»ºçš„ï¼Œéœ€è¦é¢å¤–ç”Ÿæˆã€‚ åœ¨æœåŠ¡å‰¯æœ¬æ•°ä¸º0æ—¶ï¼ŒæŸ¥çœ‹ä¸€ä¸‹Serviceå¯¹åº”çš„Endpointï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345$ kubectl -n faas get epNAME ENDPOINTS AGEhello-go-fpmln 172.31.16.81:8012 hello-go-fpmln-m9mmg 172.31.16.121:8012,172.31.16.121:8022 hello-go-fpmln-metrics 172.31.16.121:9090,172.31.16.121:9091 å…¶ä¸­ï¼Œpublic Serviceçš„Endpoint IPæ˜¯Knative Activatorçš„Pod IPï¼Œå®é™…å‘ç°Activatorçš„å‰¯æœ¬æ•°è¶Šå¤šè¿™é‡Œä¹Ÿä¼šç›¸åº”çš„å¢åŠ ã€‚å¹¶ä¸”ç”±ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹åˆ°ï¼Œvsçš„destinationæŒ‡å‘çš„å°±æ˜¯public Serviceã€‚ è¾“å…¥å‡ æ¬¡curlå‘½ä»¤æ¨¡æ‹Ÿä¸€ä¸‹httpè¯·æ±‚ï¼Œè™½ç„¶å‰¯æœ¬æ•°ä»0å¼€å§‹å¢åŠ åˆ°1äº†ï¼Œä½†æ˜¯è¿™é‡Œçš„Endpointå´æ²¡æœ‰å˜åŒ–ï¼Œä»ç„¶ä¸ºActivator Pod IPã€‚ æ¥ç€ä½¿ç”¨heyæ¥å‹æµ‹ä¸€ä¸‹ï¼š 12./hey_linux_amd64 -n 1000000 -c 300 -m GET -host helloworld-go.faas.example.com http://&lt;IngressIP&gt;:80 å‘ç°Endpointå˜åŒ–äº†ï¼Œé€šè¿‡å¯¹æ¯”æœåŠ¡çš„Pod IPï¼Œå·²ç»å˜æˆäº†æ–°å¯åŠ¨çš„æœåŠ¡Pod IPï¼Œä¸å†æ˜¯Activator Podçš„IPã€‚ 12345$ kubectl -n faas get epNAME ENDPOINTS helloworld-go-mpk25 172.31.16.121:8012hello-go-fpmln-m9mmg 172.31.16.121:8012,172.31.16.121:8022 hello-go-fpmln-metrics 172.31.16.121:9090,172.31.16.121:9091 åŸæ¥ï¼Œç°åœ¨æ–°ç‰ˆæœ¬çš„å†·å¯åŠ¨æµé‡è½¬å‘æœºåˆ¶å·²ç»ä¸å†æ˜¯é€šè¿‡ä¿®æ”¹vsæ¥æ”¹å˜ç½‘å…³çš„æµé‡è½¬å‘é…ç½®äº†ï¼Œè€Œæ˜¯ç›´æ¥æ›´æ–°æœåŠ¡çš„public Serviceåç«¯Endpointï¼Œä»è€Œå®ç°å°†æµé‡ä»Activatorè½¬å‘åˆ°å®é™…çš„æœåŠ¡Podä¸Šã€‚ é€šè¿‡å°†æµé‡çš„è½¬å‘åŠŸèƒ½å†…èšåˆ°Service/Endpointå±‚ï¼Œä¸€æ–¹é¢å‡å°äº†ç½‘å…³çš„é…ç½®æ›´æ–°å‹åŠ›ï¼Œä¸€æ–¹é¢Knativeå¯ä»¥åœ¨å¯¹æ¥å„ç§ä¸åŒçš„ç½‘å…³æ—¶çš„å®ç°æ—¶æ›´åŠ è§£è€¦ï¼Œç½‘å…³å±‚ä¸å†éœ€è¦å…³å¿ƒå†·å¯åŠ¨æ—¶çš„æµé‡è½¬å‘æœºåˆ¶ã€‚ æµé‡è·¯å¾„å†æ·±å…¥ä»ä¸Šè¿°çš„ä¸‰ä¸ªServiceå…¥æ‰‹ç ”ç©¶ï¼Œå®ƒä»¬çš„ownerReferenceæ˜¯serverlessservice.networking.internal.knative.dev(sks)ï¼Œè€Œsksçš„ownerReferenceæ˜¯podautoscaler.autoscaling.internal.knative.dev(kpa)ã€‚ åœ¨å‹æµ‹è¿‡ç¨‹ä¸­åŒæ ·å‘ç°ï¼Œsksä¼šåœ¨å†·å¯åŠ¨è¿‡åï¼Œä¼šä»Proxyæ¨¡å¼å˜ä¸ºServeæ¨¡å¼ï¼š 123456$ kubectl -n faas get sksNAME MODE SERVICENAME PRIVATESERVICENAME READY REASONhello-go-fpmln Proxy hello-go-fpmln hello-go-fpmln-m9mmg True$ kubectl -n faas get sksNAME MODE SERVICENAME PRIVATESERVICENAME READY REASONhello-go-fpmln Serve hello-go-fpmln hello-go-fpmln-m9mmg True è¿™ä¹Ÿæ„å‘³ç€ï¼Œå½“æµé‡ä»Activatorå¯¼å…¥çš„æ—¶å€™ï¼Œsksä¸ºProxyæ¨¡å¼ï¼ŒæœåŠ¡çœŸæ­£å¯åŠ¨èµ·æ¥åä¼šå˜æˆServeæ¨¡å¼ï¼Œç½‘å…³æµé‡ç›´æ¥æµå‘æœåŠ¡Podã€‚ ä»åç§°ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œskså’Œkpaå‡ä¸ºKnativeå†…éƒ¨CRDï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç”±äºKnativeè®¾è®¡ä¸Šå¯ä»¥æ”¯æŒè‡ªå®šä¹‰çš„æ‰©ç¼©å®¹æ–¹å¼å’Œæ”¯æŒKubernetes HPAæœ‰å…³ï¼Œå®ç°æ›´é«˜ä¸€å±‚çš„æŠ½è±¡ã€‚","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"knative","slug":"knative","permalink":"https://acodetailor.github.io/tags/knative/"}]},{"title":"Serverlessä¹‹ä»‹ç»","slug":"serverless","date":"2021-04-28T06:35:10.932Z","updated":"2021-05-20T01:08:34.408Z","comments":false,"path":"2021/04/28/serverless/","link":"","permalink":"https://acodetailor.github.io/2021/04/28/serverless/","excerpt":"","text":"ä¸€ã€Serverlessæ˜¯ä»€ä¹ˆServerless ï¼ŒæŒ‰ä¸­æ–‡ç¿»è¯‘ï¼Œç§°ä¸ºã€Œæ— æœåŠ¡å™¨ã€ã€‚è¿™ç©¶ç«Ÿæ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„å½¢æ€æˆ–äº§å“å‘¢ï¼Ÿæ— æœåŠ¡å™¨ï¼Œå°±æ˜¯çœŸçš„æ²¡æœ‰æœåŠ¡å™¨å—ï¼Ÿå®é™…å¹¶ä¸æ˜¯æ²¡æœ‰æœåŠ¡å™¨ï¼Œåªæ˜¯ç”¨æˆ·åªæ˜¯ä¸ç”¨æ›´å¤šçš„å»è€ƒè™‘æœåŠ¡å™¨çš„ç›¸å…³å†…å®¹äº†ï¼Œæ— éœ€å†å»è€ƒè™‘æœåŠ¡å™¨çš„è§„æ ¼å¤§å°ã€å­˜å‚¨ç±»å‹ã€ç½‘ç»œå¸¦å®½ã€è‡ªåŠ¨æ‰©ç¼©å®¹çš„é—®é¢˜ã€‚ äºŒã€Serverlessçš„å‘å±• Serverlessé€šå¸¸æ˜¯æŒ‡FaaSå’ŒBaaSï¼šFunctions-as-a-Service (FaaS) ï¼Œé€šå¸¸æä¾›äº‹ä»¶é©±åŠ¨è®¡ç®—ã€‚å¼€å‘äººå‘˜ä½¿ç”¨ç”±äº‹ä»¶æˆ–HTTPè¯·æ±‚è§¦å‘çš„functionæ¥è¿è¡Œå’Œç®¡ç†åº”ç”¨ç¨‹åºä»£ç ã€‚Backend-as-a-Service (BaaS) ï¼Œå®ƒæ˜¯åŸºäºAPIçš„ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œå¯æ›¿ä»£åº”ç”¨ç¨‹åºä¸­çš„æ ¸å¿ƒåŠŸèƒ½å­é›†ã€‚ä¾‹å¦‚æ•°æ®åº“ã€å¯¹è±¡å­˜å‚¨ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚ ä¸‰ã€Serverlessçš„æŠ€æœ¯ç‰¹ç‚¹ï¼š1ã€äº‹ä»¶é©±åŠ¨ äº‘å‡½æ•°çš„è¿è¡Œï¼Œæ˜¯ç”±äº‹ä»¶é©±åŠ¨èµ·æ¥çš„ï¼Œåœ¨æœ‰äº‹ä»¶åˆ°æ¥æ—¶ï¼Œäº‘å‡½æ•°ä¼šå¯åŠ¨è¿è¡Œ Serverless åº”ç”¨ä¸ä¼šç±»ä¼¼äºåŸæœ‰çš„ã€Œç›‘å¬ - å¤„ç†ã€ç±»å‹çš„åº”ç”¨ä¸€ç›´åœ¨çº¿ï¼Œè€Œæ˜¯æŒ‰éœ€å¯åŠ¨ äº‹ä»¶çš„å®šä¹‰å¯ä»¥å¾ˆä¸°å¯Œï¼Œä¸€æ¬¡ http è¯·æ±‚ï¼Œä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä¸€æ¬¡æ•°æ®åº“æ¡ç›®ä¿®æ”¹ï¼Œä¸€æ¡æ¶ˆæ¯å‘é€ï¼Œéƒ½å¯ä»¥å®šä¹‰ä¸ºäº‹ä»¶ 2ã€å•äº‹ä»¶å¤„ç† äº‘å‡½æ•°ç”±äº‹ä»¶è§¦å‘ï¼Œè€Œè§¦å‘å¯åŠ¨çš„ä¸€ä¸ªäº‘å‡½æ•°å®ä¾‹ï¼Œä¸€æ¬¡ä»…å¤„ç†ä¸€ä¸ªäº‹ä»¶ æ— éœ€åœ¨ä»£ç å†…è€ƒè™‘é«˜å¹¶å‘é«˜å¯é æ€§ï¼Œä»£ç å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡ï¼Œå¼€å‘æ›´ç®€å• é€šè¿‡äº‘å‡½æ•°å®ä¾‹çš„é«˜å¹¶å‘èƒ½åŠ›ï¼Œå®ç°ä¸šåŠ¡é«˜å¹¶å‘ 3ã€è‡ªåŠ¨å¼¹æ€§ä¼¸ç¼© ç”±äºäº‘å‡½æ•°äº‹ä»¶é©±åŠ¨åŠå•äº‹ä»¶å¤„ç†çš„ç‰¹æ€§ï¼Œäº‘å‡½æ•°é€šè¿‡è‡ªåŠ¨çš„ä¼¸ç¼©æ¥æ”¯æŒä¸šåŠ¡çš„é«˜å¹¶å‘ é’ˆå¯¹ä¸šåŠ¡çš„å®é™…äº‹ä»¶æˆ–è¯·æ±‚æ•°ï¼Œäº‘å‡½æ•°è‡ªåŠ¨å¼¹æ€§åˆé€‚çš„å¤„ç†å®ä¾‹æ¥æ‰¿è½½å®é™…ä¸šåŠ¡é‡ åœ¨æ²¡æœ‰äº‹ä»¶æˆ–è¯·æ±‚æ—¶ï¼Œæ— å®ä¾‹è¿è¡Œï¼Œä¸å ç”¨èµ„æº 4ã€æ— çŠ¶æ€å¼€å‘ äº‘å‡½æ•°è¿è¡Œæ—¶æ ¹æ®ä¸šåŠ¡å¼¹æ€§ï¼Œå¯èƒ½ä¼¸ç¼©åˆ° 0ï¼Œæ— æ³•åœ¨è¿è¡Œç¯å¢ƒä¸­ä¿å­˜çŠ¶æ€æ•°æ® åˆ†å¸ƒå¼åº”ç”¨å¼€å‘ä¸­ï¼Œå‡éœ€è¦ä¿æŒåº”ç”¨çš„æ— çŠ¶æ€ï¼Œä»¥ä¾¿äºæ°´å¹³ä¼¸ç¼© å¯ä»¥åˆ©ç”¨å¤–éƒ¨æœåŠ¡ã€äº§å“ï¼Œä¾‹å¦‚æ•°æ®åº“æˆ–ç¼“å­˜ï¼Œå®ç°çŠ¶æ€æ•°æ®çš„ä¿å­˜ å››ã€ä¸šç•Œçš„Serverlessäº§å“1ã€è°·æ­Œäº‘ functionGoogleCloud functionäº§å“ä¼˜åŠ¿ä»‹ç» åˆ©ç”¨å¯ä¼¸ç¼©çš„å‡½æ•°å³æœåŠ¡ (FaaS) è¿è¡Œä»£ç ï¼Œéšç”¨éšä»˜ï¼Œå¹¶ä¸”æ— éœ€æ‰§è¡Œä»»ä½•æœåŠ¡å™¨ç®¡ç†å·¥ä½œã€‚ ä¸å¿…é¢„é…ã€ç®¡ç†æˆ–å‡çº§æœåŠ¡å™¨ æ ¹æ®è´Ÿè½½è‡ªåŠ¨æ‰©ç¼© é›†æˆå¼ç›‘æ§ã€æ—¥å¿—è®°å½•å’Œè°ƒè¯•åŠŸèƒ½ åŸºäºæœ€å°æƒé™åŸåˆ™çš„è§’è‰²å’Œå‡½æ•°çº§åˆ«çš„å†…ç½®å®‰å…¨æ€§ é€‚ç”¨äºæ··åˆäº‘å’Œå¤šäº‘ç«¯æ–¹æ¡ˆçš„å…³é”®ç½‘ç»œåŠŸèƒ½ GoogleCloudäº§å“ç•Œé¢ å‡½æ•°åˆ—è¡¨ åˆ›å»ºå‡½æ•°ï¼Œé…ç½®HTTPè§¦å‘å™¨æš´éœ²å¯¹åº”çš„å‡½æ•° 2ã€AWSAWSæ‹¥æœ‰å’ŒGoogle functionç±»ä¼¼çš„äº§å“ï¼Œå«åšlambda. lambdaå‡½æ•°åˆ—è¡¨ é…ç½®HTTPè§¦å‘å™¨æš´lambdaéœ²å‡½æ•° 3ã€é˜¿é‡Œäº‘é˜¿é‡Œäº‘ä¹Ÿæœ‰è‡ªå·±çš„Serverlessäº§å“ï¼Œåˆ†åˆ«æ˜¯å‡½æ•°è®¡ç®—å’ŒServerlesså·¥ä½œæµï¼Œå‡½æ•°è®¡ç®—å’ŒGoogleçš„functionï¼ŒAWSçš„lambdaåŸºæœ¬ä¸€æ ·ï¼Œä¸å¤šåšä»‹ç»äº†ã€‚ ä¸‹è¾¹çœ‹ä¸€ä¸‹Serverlesså·¥ä½œæµè¿™ä¸ªäº§å“ã€‚åœ¨Serverlesså·¥ä½œæµä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡yamlæ¥ç¼–æ’å‡½æ•°ï¼Œäº‹ä»¶ä¼šæŒ‰ç…§å·¥ä½œæµçš„å®šä¹‰ï¼Œæµè½¬å·¥ä½œæµä¸­çš„æœåŠ¡ï¼Œä»¥å®ç°ä¸€å®šçš„ä¸šåŠ¡é€»è¾‘ï¼Œåˆ›å»ºé¡µé¢å¦‚ä¸‹å›¾ 4ã€æµ·å°”æ™ºå®¶PSIæˆ‘ä»¬PSIä¹Ÿæœ‰ä¸€æ¬¾Serverlessäº§å“ï¼Œç›®å‰å·²ä¸Šçº¿äº‹ä»¶é©±åŠ¨æµç¨‹åŠŸèƒ½ï¼Œé…åˆå·¥å•é€šçŸ¥ä¸šåŠ¡ï¼Œå·²è½åœ°ç”Ÿäº§ã€‚åŒæ­¥å‡½æ•°è®¡ç®—åŠŸèƒ½ï¼Œæ­£åœ¨è¿­ä»£ä¸­ï¼Œè¿‘æœŸå°±ä¼šä¸Šçº¿ï¼Œæ•¬è¯·æœŸå¾…ã€‚ äº§å“ä¸»ç•Œé¢ï¼š äº‹ä»¶æµç¨‹ç•Œé¢ï¼š äº‹ä»¶æµç¨‹é€šè¿‡æµç¨‹å›¾çš„å½¢å¼ç¼–æ’æœåŠ¡ï¼Œæ›´åŠ ç›´è§‚ã€æ˜“æ‡‚ã€‚ PSI Serverlessäº§å“ä½“éªŒåœ°å€ï¼šhttps://edgy.haier.netPSI Serverlessäº§å“æ–‡æ¡£åœ°å€ï¼šhttps://edgy.haier.net/doc","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"}]},{"title":"javaçš„OOMé—®é¢˜","slug":"java_oom","date":"2021-04-24T12:11:36.499Z","updated":"2021-04-28T06:34:43.262Z","comments":false,"path":"2021/04/24/java_oom/","link":"","permalink":"https://acodetailor.github.io/2021/04/24/java_oom/","excerpt":"","text":"ä¸€ã€ä¸€äº›æ¦‚å¿µJVMä¸­çš„å †è¢«åˆ’åˆ†ä¸ºä¸¤ä¸ªä¸åŒåŒºåŸŸï¼šæ–°ç”Ÿä»£Youngã€è€å¹´ä»£Oldã€‚æ–°ç”Ÿä»£åˆåˆ’åˆ†ä¸ºEden(ä¼Šç”¸ï¼Œæ ‡å¿—æ–°ç”Ÿ)ï¼Œ Survivor0(s0)ï¼Œ Survivor(s1)ã€‚JVMä¸­å †çš„GCåˆ†ä¸ºï¼šMinor GC å’Œ Full GC(åˆç§°ä¸ºMajor GC) å¹´è½»ä»£å¹´è½»ä»£ç”¨äºå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå­˜å‚¨å¤§å°é»˜è®¤ä¸ºå †å¤§å°çš„1/15ï¼Œç‰¹ç‚¹æ˜¯å¯¹è±¡æ›´æ›¿é€Ÿåº¦å¿«ï¼Œå³çŸ­æ—¶é—´å†…äº§ç”Ÿå¤§é‡çš„â€œæ­»äº¡å¯¹è±¡â€-Xmn å¯ä»¥è®¾ç½®å¹´è½»ä»£ä¸ºå›ºå®šå¤§å°-XX:NewRatio å¯ä»¥è®¾ç½®å¹´è½»ä»£ä¸è€å¹´ä»£çš„å¤§å°æ¯”ä¾‹å¹´è½»ä»£ä½¿ç”¨å¤åˆ¶-æ¸…é™¤ç®—æ³•å’Œå¹¶è¡Œæ”¶é›†å™¨è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¯¹å¹´è½»ä»£çš„åƒåœ¾å›æ”¶ç§°ä¸ºåˆçº§å›æ”¶ï¼ˆminor GC)minor GC å°†å¹´è½»ä»£åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼Œä¸€ä¸ªEden, ä¸¤ä¸ªå¤§å°ç›¸åŒçš„Survivorã€‚åº”ç”¨ç¨‹åºåªèƒ½åŒæ—¶ä½¿ç”¨ä¸€ä¸ªEdenå’Œä¸€ä¸ªæ´»åŠ¨Survivor, å¦å¤–ä¸€ä¸ªSurvivorä¸ºéæ´»åŠ¨Survivorï¼ˆä¸¤ä¸ªSurvivoråœ¨æ´»åŠ¨ä¸éæ´»åŠ¨é—´äº¤æ›¿å­˜åœ¨ï¼Œå³åŒä¸€æ—¶åˆ»åªå­˜åœ¨ä¸€ä¸ªæ´»åŠ¨Survivorå’Œä¸€ä¸ªéæ´»åŠ¨Survivorï¼‰ã€‚å½“å‘ç”Ÿ minor GCæ—¶ï¼šJVMæ‰§è¡Œä¸‹è¿°æ“ä½œ å°†ç¨‹åºæŒ‚èµ· å°†Edenå’Œæ´»åŠ¨Survivorä¸­çš„å­˜æ´»å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡æŒ‡çš„æ˜¯ä»è¢«å¼•ç”¨çš„å¯¹è±¡ï¼‰å¤åˆ¶åˆ°å¦ä¸€ä¸ªéæ´»åŠ¨çš„Survivorä¸­ï¼ˆè®°å½•å¯¹è±¡è¢«å¤åˆ¶åˆ°å¦ä¸€ä¸ªSurvivorçš„æ¬¡æ•°ï¼Œåœ¨æ­¤ç§°ä¸ºå¹´é¾„æ•°ï¼Œæ¯æ¬¡å¤åˆ¶+1ï¼‰ æ¸…é™¤Edenå’Œæ´»åŠ¨Survivorä¸­å¯¹è±¡ å°†éæ´»åŠ¨Survivoræ ‡è®°ä¸ºæ´»åŠ¨ï¼Œå°†åŸæ¥çš„æ´»åŠ¨Survivoræ ‡è®°ä¸ºéæ´»åŠ¨ä¸Šè¿°å³ä¸ºä¸€è½® minor GC ç»“æŸå¦‚æ­¤å¾€å¤å¤šæ¬¡ minor GCåï¼Œå°†å¤šæ¬¡è¢«å¤åˆ¶çš„å¯¹è±¡ï¼ˆé«˜é¾„å¯¹è±¡ï¼‰ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­é»˜è®¤è¢«ç§»åŠ¨åˆ°è€å¹´ä»£çš„å¹´é¾„ä¸º15ï¼Œå¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuring Threshold æ¥è®¾ç½®ã€‚å½“ç„¶ï¼Œå¯¹äºä¸€äº›å ç”¨è¾ƒå¤§å†…å­˜çš„å¯¹è±¡ï¼Œä¼šè¢«ç›´æ¥é€å…¥è€å¹´ä»£ è€å¹´ä»£è€å¹´ä»£å­˜å‚¨çš„æ˜¯é‚£äº›ä¸ä¼šè½»æ˜“â€œæ­»æ‰â€çš„å¯¹è±¡ï¼Œæ¯•ç«Ÿéƒ½åœ¨å¹´è½»ä»£ä¸­ç†¬å‡ºäº†å¤´ã€‚åœ¨è€å¹´ä»£å‘ç”Ÿçš„GCæˆä¸º Full GC ã€‚Full GC ä¸ä¼šåƒ Minor GCé‚£ä¹ˆé¢‘ç¹Full GC é‡‡ç”¨ æ ‡è®°-æ¸…é™¤ç®—æ³• æ”¶é›†åƒåœ¾çš„æ—¶å€™ä¼šäº§ç”Ÿè®¸å¤šå†…å­˜ç¢ç‰‡ï¼ˆä¸è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼‰ï¼Œå› æ­¤æ­¤åè‹¥æœ‰è¾ƒå¤§çš„å¯¹è±¡è¦è¿›å…¥è€å¹´ä»£è€Œæ— æ³•æ‰¾åˆ°é€‚åˆçš„å­˜å‚¨ç©ºé—´ï¼Œå°±ä¼šæå‰è§¦å‘ä¸€æ¬¡GCæ”¶é›†ï¼Œå¯¹å†…å­˜ç©ºé—´è¿›è¡Œæ•´ç† æ°¸ä¹…ä»£æ°¸ä¹…ä»£ï¼ˆPerm Genï¼‰æ˜¯JDK7ä¸­çš„ç‰¹æ€§ï¼ŒJDK8åè¢«å–æ¶ˆã€‚æ°¸ä¹…åŒºæ˜¯JVMæ–¹æ³•åŒºçš„å®ç°æ–¹å¼ä¹‹ä¸€ï¼ŒJDK8èµ·ï¼Œè¢«å…ƒç©ºé—´ï¼ˆä¸å †ä¸ç›¸è¿çš„æœ¬åœ°ç©ºé—´ï¼‰å–è€Œä»£ä¹‹æ°¸ä¹…ä»£å­˜æ”¾çš„æ˜¯åº”ç”¨å…ƒæ•°æ®ï¼ˆåº”ç”¨ä¸­ä½¿ç”¨çš„ç±»å’Œæ–¹æ³•ï¼‰ï¼Œæ°¸ä¹…ä»£ä¸­çš„å¯¹è±¡åœ¨ Full GC çš„æ—¶å€™è¿›è¡Œåƒåœ¾å›æ”¶ ç®€å•æ¥è®²ï¼Œjvmçš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šå¯¹è±¡åœ¨Eden Spaceåˆ›å»ºï¼Œå½“Eden Spaceæ»¡äº†çš„æ—¶å€™ï¼Œgcå°±æŠŠæ‰€æœ‰åœ¨Eden Spaceä¸­çš„å¯¹è±¡æ‰«æä¸€æ¬¡ï¼ŒæŠŠæ‰€æœ‰æœ‰æ•ˆçš„å¯¹è±¡å¤åˆ¶åˆ°ç¬¬ä¸€ä¸ªSurvivor Spaceï¼ŒåŒæ—¶æŠŠæ— æ•ˆçš„å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´é‡Šæ”¾ã€‚å½“Eden Spaceå†æ¬¡å˜æ»¡äº†çš„æ—¶å€™ï¼Œå°±å¯åŠ¨ç§»åŠ¨ç¨‹åºæŠŠEden Spaceä¸­æœ‰æ•ˆçš„å¯¹è±¡å¤åˆ¶åˆ°ç¬¬äºŒä¸ªSurvivor Spaceï¼ŒåŒæ—¶ï¼Œä¹Ÿå°†ç¬¬ä¸€ä¸ªSurvivor Spaceä¸­çš„æœ‰æ•ˆå¯¹è±¡å¤åˆ¶åˆ°ç¬¬äºŒä¸ªSurvivor Spaceã€‚å¦‚æœå¡«å……åˆ°ç¬¬äºŒä¸ªSurvivor Spaceä¸­çš„æœ‰æ•ˆå¯¹è±¡è¢«ç¬¬ä¸€ä¸ªSurvivor Spaceæˆ–Eden Spaceä¸­çš„å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡å°±æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œæ­¤æ—¶è¿™äº›å¯¹è±¡å°†è¢«å¤åˆ¶åˆ°Permanent Generationã€‚ è‹¥åƒåœ¾æ”¶é›†å™¨ä¾æ®è¿™ç§å°å¹…åº¦çš„è°ƒæ•´æ”¶é›†ä¸èƒ½è…¾å‡ºè¶³å¤Ÿçš„ç©ºé—´ï¼Œå°±ä¼šè¿è¡ŒFull GCï¼Œæ­¤æ—¶jvm gcåœæ­¢æ‰€æœ‰åœ¨å †ä¸­è¿è¡Œçš„çº¿ç¨‹å¹¶æ‰§è¡Œæ¸…é™¤åŠ¨ä½œã€‚ äºŒã€ä¼˜åŒ–é…ç½®-Xms æ˜¯æŒ‡ç¨‹åºå¯åŠ¨æ—¶åˆå§‹å†…å­˜å¤§å°ï¼ˆæ­¤å€¼å¯ä»¥è®¾ç½®æˆä¸-Xmxç›¸åŒï¼Œä»¥é¿å…æ¯æ¬¡GCå®Œæˆå JVM å†…å­˜é‡æ–°åˆ†é…ï¼‰ã€‚é»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/64ï¼Œæœ€å°ä¸º1Mï¼›å¯ä»¥æŒ‡å®šå•ä½ï¼Œæ¯”å¦‚kã€mï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ºå­—èŠ‚ã€‚-Xmx æŒ‡ç¨‹åºè¿è¡Œæ—¶æœ€å¤§å¯ç”¨å†…å­˜å¤§å°ï¼Œç¨‹åºè¿è¡Œä¸­å†…å­˜å¤§äºè¿™ä¸ªå€¼ä¼š OutOfMemoryã€‚é»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/4æˆ–è€…1Gï¼Œæœ€å°ä¸º2Mï¼›å•ä½ä¸-Xmsä¸€è‡´-Xmn å¹´è½»ä»£å¤§å°ï¼ˆæ•´ä¸ªJVMå†…å­˜å¤§å° = å¹´è½»ä»£ + å¹´è€ä»£ + æ°¸ä¹…ä»£ï¼‰ã€‚-XX:NewRatio å¹´è½»ä»£ä¸å¹´è€ä»£çš„å¤§å°æ¯”ä¾‹ï¼Œ-XX:NewRatio=4 è®¾ç½®ä¸º4ï¼Œåˆ™å¹´è½»ä»£ä¸å¹´è€ä»£æ‰€å æ¯”å€¼ä¸º1ï¼š4ã€‚-XX:SurvivorRatio å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ï¼Œ-XX:SurvivorRatio=4ï¼Œè®¾ç½®ä¸º4ï¼Œåˆ™ä¸¤ä¸ªSurvivoråŒºä¸ä¸€ä¸ªEdenåŒºçš„æ¯”å€¼ä¸º 2:4-XX:MaxPermSize è®¾ç½®æ°¸ä¹…ä»£å¤§å°ã€‚-XX:MaxTenuringThreshold è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„ã€‚å¦‚æœè®¾ç½®ä¸º0çš„è¯ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒºï¼Œç›´æ¥è¿›å…¥å¹´è€ä»£ã€‚å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œå¯ä»¥æé«˜æ•ˆç‡ã€‚å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶ï¼Œè¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡å†å¹´è½»ä»£çš„å­˜æ´»æ—¶é—´ï¼Œå¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚è®ºã€‚-Xss è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚é»˜è®¤ä¸º512k ä¸‰ã€å®¹å™¨åŒ–åœºæ™¯é…ç½®ä½¿ç”¨å®¹å™¨å†…å­˜å¤§å°ï¼Œé¿å…Cgroupçš„oomJDK 8u131 åœ¨ JDK 9 ä¸­æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå¯ä»¥åœ¨ Docker å®¹å™¨è¿è¡Œæ—¶èƒ½å¤Ÿæ£€æµ‹åˆ°å¤šå°‘å†…å­˜çš„èƒ½åŠ›ã€‚åœ¨å®¹å™¨å†…éƒ¨è¿è¡Œ JVMï¼Œå®ƒåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å°†å¦‚ä½•é»˜è®¤æœ€å¤§å †ä¸ºä¸»æœºå†…å­˜çš„1/4ï¼Œè€Œéå®¹å™¨å†…å­˜çš„1/4ã€‚å¦‚æœå¯¹ Java å®¹å™¨ä¸­çš„jvmè™šæ‹Ÿæœºä¸åšä»»ä½•é™åˆ¶ï¼Œå½“æˆ‘ä»¬åŒæ—¶è¿è¡Œå‡ ä¸ª java å®¹å™¨æ—¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æœåŠ¡å™¨çš„å†…å­˜è€—å°½ã€è´Ÿè½½é£™å‡è€Œå®•æœºï¼›è€Œå¦‚æœæˆ‘ä»¬å¯¹å®¹å™¨ç›´æ¥è¿›è¡Œé™åˆ¶ï¼Œå°±ä¼šå¯¼è‡´å†…æ ¸åœ¨æŸä¸ªæ—¶å€™æ€æ­»jvm å®¹å™¨è€Œå¯¼è‡´é¢‘ç¹é‡å¯ã€‚ 12345$ docker run -m 100MB openjdk:8u121 java -XshowSettings:vm -versionVM settings: Max. Heap Size (Estimated): 444.50M Ergonomics Machine Class: server Using VM: OpenJDK 64-Bit Server VM ä¸‹é¢æˆ‘ä»¬å°è¯• JDK 8u131 ä¸­çš„å®éªŒæ€§å‚æ•° -XX:+UseCGroupMemoryLimitForHeap 12345678$ docker run -m 100MB openjdk:8u131 java \\ -XX:+UnlockExperimentalVMOptions \\ -XX:+UseCGroupMemoryLimitForHeap \\ -XshowSettings:vm -versionVM settings: Max. Heap Size (Estimated): 44.50M Ergonomics Machine Class: server Using VM: OpenJDK 64-Bit Server VM JVMèƒ½å¤Ÿæ£€æµ‹å®¹å™¨åªæœ‰100MBï¼Œå¹¶å°†æœ€å¤§å †è®¾ç½®ä¸º44Mã€‚ ä¸‹é¢å°è¯•ä¸€ä¸ªæ›´å¤§çš„å®¹å™¨ 12345678$ docker run -m 1GB openjdk:8u131 java \\ -XX:+UnlockExperimentalVMOptions \\ -XX:+UseCGroupMemoryLimitForHeap \\ -XshowSettings:vm -versionVM settings: Max. Heap Size (Estimated): 228.00M Ergonomics Machine Class: server Using VM: OpenJDK 64-Bit Server VM å—¯ï¼Œç°åœ¨å®¹å™¨æœ‰1GBï¼Œä½†JVMä»…ä½¿ç”¨228Mä½œä¸ºæœ€å¤§å †ã€‚ é™¤äº†JVMæ­£åœ¨å®¹å™¨ä¸­è¿è¡Œä»¥å¤–ï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜å¯ä»¥ä¼˜åŒ–å®ƒå‘¢ï¼Ÿ 12345678$ docker run -m 1GB openjdk:8u131 java \\ -XX:+UnlockExperimentalVMOptions \\ -XX:+UseCGroupMemoryLimitForHeap \\ -XX:MaxRAMFraction=1 -XshowSettings:vm -versionVM settings: Max. Heap Size (Estimated): 910.50M Ergonomics Machine Class: server Using VM: OpenJDK 64-Bit Server VM ä½¿ç”¨-XX:MaxRAMFraction æˆ‘ä»¬å‘Šè¯‰JVMä½¿ç”¨å¯ç”¨å†…å­˜/ MaxRAMFractionä½œä¸ºæœ€å¤§å †ã€‚ä½¿ç”¨-XX:MaxRAMFraction=1æˆ‘ä»¬å‡ ä¹æ‰€æœ‰å¯ç”¨çš„å†…å­˜ä½œä¸ºæœ€å¤§å †ã€‚","categories":[{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://acodetailor.github.io/categories/%E8%BF%90%E7%BB%B4/"}],"tags":[{"name":"oom","slug":"oom","permalink":"https://acodetailor.github.io/tags/oom/"}]},{"title":"Minikubeæ­å»ºistioå’ŒKnative","slug":"install knative","date":"2021-04-19T09:26:51.731Z","updated":"2021-04-28T06:32:58.096Z","comments":false,"path":"2021/04/19/install knative/","link":"","permalink":"https://acodetailor.github.io/2021/04/19/install%20knative/","excerpt":"","text":"éœ€è¦æ­å»ºä¸€å¥—knativeçš„æµ‹è¯•ç¯å¢ƒï¼Œä½†æ˜¯æ²¡æœ‰æµ‹è¯•é›†ç¾¤å¯ä»¥ç”¨äº†ï¼Œå°±ç”¨è‡ªå·±çš„ç”µè„‘æ­å»ºäº†ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒã€‚æ­å»ºè¿‡ç¨‹è®°å½•ä¸€ä¸‹ ç¯å¢ƒä¿¡æ¯os:MacDriver:VirtualBox æ­å»ºminikubeä¸€æ¡å‘½ä»¤å³å¯,å¯ä»¥æŒ‡å®šcpuå’Œå†…å­˜â€“cpus int â€“memory int 1minikube start --vm-driver=virtualbox --image-repository=&#x27;registry.cn-hangzhou.aliyuncs.com/google_containers&#x27; minikubeå¸¸ç”¨å‘½ä»¤ 123456789101112131415161718191. minikube start å¯åŠ¨minikube2. minikube dashboard æ‰“å¼€dashboard3. minikube version æŸ¥çœ‹minikubeç‰ˆæœ¬4. minikube status æŸ¥çœ‹é›†ç¾¤çŠ¶æ€5. minikube ip æ˜¾ç¤ºè™šæ‹Ÿæœºipåœ°å€6. minikube stop åœæ­¢è™šæ‹Ÿæœº7. minikube ssh sshåˆ°è™šæ‹Ÿæœºä¸­8. minikube delete åˆ é™¤è™šæ‹Ÿæœº9. minikube logs æŸ¥çœ‹è™šæ‹Ÿæœºæ—¥å¿—10. minikube update-check æ£€æŸ¥æ›´æ–°11. minikube node list[add|start|stop|delete] å¯¹èŠ‚ç‚¹è¿›è¡Œæ“ä½œ12. minikube mount å°†æŒ‡å®šçš„ç›®å½•æŒ‚è½½åˆ°minikube13. minikube docker-env é…ç½®ç¯å¢ƒä»¥ä½¿ç”¨minikubeçš„dockerå®ˆæŠ¤è¿›ç¨‹14. minikube podman-env é…ç½®ç¯å¢ƒä»¥ä½¿ç”¨minikubeçš„PodmanæœåŠ¡15. minikube cache æ·»åŠ ï¼Œåˆ é™¤ï¼Œæˆ–æ¨é€ä¸€ä¸ªæœ¬åœ°æ˜ åƒåˆ°minikube16. minikube addons å¯ç”¨æˆ–ç¦ç”¨ä¸€ä¸ªminikubeæ’ä»¶17. minikube config ä¿®æ”¹æŒä¹…åŒ–é…ç½®å€¼18. minikube profile è·å–æˆ–è€…åˆ—å‡ºå½“å‰çš„é…ç½®æ–‡ä»¶ï¼ˆé›†ç¾¤ï¼‰19. minikube update-context åœ¨IPæˆ–è€…ç«¯å£æ”¹å˜çš„æƒ…å†µä¸‹æ›´æ–°kubeconfig å®‰è£…æˆåŠŸåæç¤ºå¦‚ä¸‹ï¼š 12345678910ğŸ˜„ Darwin 10.14.6 ä¸Šçš„ minikube v1.8.2âœ¨ æ ¹æ®ç°æœ‰çš„é…ç½®æ–‡ä»¶ä½¿ç”¨ virtualbox é©±åŠ¨ç¨‹åºâœ… æ­£åœ¨ä½¿ç”¨é•œåƒå­˜å‚¨åº“ registry.cn-hangzhou.aliyuncs.com/google_containersğŸ’¾ Downloading preloaded images tarball for k8s v1.17.3 ...âŒ› é‡æ–°é…ç½®ç°æœ‰ä¸»æœºğŸƒ Using the running virtualbox &quot;minikube&quot; VM ...ğŸ³ æ­£åœ¨ Docker 19.03.6 ä¸­å‡†å¤‡ Kubernetes v1.17.3â€¦ğŸš€ æ­£åœ¨å¯åŠ¨ Kubernetes ... ğŸŒŸ Enabling addons: default-storageclass, storage-provisionerğŸ„ å®Œæˆï¼kubectl å·²ç»é…ç½®è‡³ &quot;minikube&quot; æ­å»ºistioä¸‹è½½istioçš„åŒ…ï¼Œç„¶åæ ¹æ®æç¤ºé…ç½®ç¯å¢ƒå˜é‡ï¼Œç”±äºæŸäº›å·²çŸ¥åŸå› ï¼Œå¯ä»¥é…ç½®host 1199.232.28.133 raw.githubusercontent.com 1curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.9.1 TARGET_ARCH=x86_64 sh - å®‰è£…å‘½ä»¤ï¼šæ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„profile 12istioctl manifest apply --set profile=demo //ä½¿ç”¨è¿™æ¡å‘½ä»¤å®‰è£…å¤±è´¥äº†ã€‚istioctl install --set profile=demo -y è¿½åŠ éƒ¨ç½²addons 12cd istio-1.9.1kc --context=minikube apply -f samples/addons -n istio-system æ­å»ºknativeknativeæ­å»ºæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼Œå†éº»çƒ¦ä¸€ç‚¹ï¼Œå¯ä»¥è‡ªå·±ä¸‹è½½yamlæ‰‹åŠ¨æ‰§è¡Œï¼Œservingå’Œeventingä¸€å…±å››ä¸ªyaml 1234serving-crdsserving-coreeventing-crdseventing-core 1kubectl apply --filename &quot;https://github.com/knative/serving/releases/download/v0.17.0/serving-crds.yaml&quot; æ¯”è¾ƒéº»çƒ¦çš„æ˜¯é•œåƒï¼Œå›½å†…æ— æ³•ç›´æ¥ä¸‹è½½åˆ°ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½åï¼Œä½¿ç”¨minikube cache æ·»åŠ åˆ°minikubeçš„èŠ‚ç‚¹ä¸Šã€‚ ç»“æœ","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"}]},{"title":"è®°ä¸€æ¬¡OOMçš„é—®é¢˜æ’æŸ¥","slug":"ops-oom","date":"2021-04-12T13:03:40.025Z","updated":"2021-04-28T06:34:43.266Z","comments":false,"path":"2021/04/12/ops-oom/","link":"","permalink":"https://acodetailor.github.io/2021/04/12/ops-oom/","excerpt":"","text":"ä¸€ã€é—®é¢˜ç°è±¡ ä¸‰å¤©å‰ï¼Œä¸šåŠ¡çš„podé‡å¯äº†ï¼Œä¸šåŠ¡æƒ³çŸ¥é“å…·ä½“åŸå› ã€‚ äºŒã€æ’æŸ¥è®°å½• é¦–å…ˆæ’æŸ¥kubeletæ—¥å¿—ï¼Œè›‹ç–¼çš„æ˜¯æœŸé—´ä¸šåŠ¡æ‰‹åŠ¨é‡å¯äº†å‡ æ¬¡ï¼Œå¯¼è‡´ä¸çŸ¥é“podé‡å¯æ—¶æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚ä¸€ä¸ªä¸ªèŠ‚ç‚¹æ’æŸ¥kubeletçš„æ—¥å¿—ï¼ˆä¸çŸ¥é“åç»­æœ‰æ²¡æœ‰å¥½çš„æ–¹æ³•ï¼‰ï¼Œæ‰¾åˆ°èŠ‚ç‚¹å‘ç°æ—¥å¿—å¦‚ä¸‹ï¼š kubeletæ‰§è¡ŒPLEGæ—¶å‘ç°å®¹å™¨æŒ‚æ‰äº†ï¼Œç›´æ¥ç»™æ‹‰èµ·äº†ï¼Œå°±æ˜¯ä¸šåŠ¡å‰å°å‘ç°çš„é‡å¯äº‹ä»¶ã€‚ å†æ’æŸ¥ä¸šåŠ¡æ—¥å¿—ï¼Œå‘ç°åªæœ‰Killed,å…«æˆæ˜¯OOMäº†ã€‚æ—¥å¿—æˆªå›¾å¦‚ä¸‹ï¼š ä¸‹ä¸€æ­¥æ’æŸ¥å†…æ ¸æ—¥å¿—ï¼Œkerenalã€‚å‘ç°ç¡®å®æ˜¯OOMäº†ã€‚æˆªå›¾å¦‚ä¸‹: ç„¶åé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬çš„ç›‘æ§å‘ç°å¹¶æ²¡æœ‰è¾¾åˆ°å†…å­˜çš„ä¸Šé™ï¼Œä½†æ˜¯cgroupç¡®å®è¾¾åˆ°äº†ä¸Šé™ã€‚çœŸæ˜¯è®©äººå¤´å¤§å•Šã€‚ ä¸‰ã€å‡ ä¸ªå‘½ä»¤12zgrep &quot;&quot; *.gzjournalctl --since &#x27;2021-04-09 22:00&#x27; å››ã€å¼•ç”³é—®é¢˜ 1ã€cgroupçš„æœºåˆ¶ 2ã€javaçš„å†…å­˜æœºåˆ¶","categories":[{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://acodetailor.github.io/categories/%E8%BF%90%E7%BB%B4/"}],"tags":[{"name":"oom","slug":"oom","permalink":"https://acodetailor.github.io/tags/oom/"}]},{"title":"è®°ä¸€æ¬¡è¶…çº§å‘çš„é—®é¢˜æ’æŸ¥","slug":"problem","date":"2021-04-09T06:37:26.865Z","updated":"2021-11-03T09:41:05.778Z","comments":false,"path":"2021/04/09/problem/","link":"","permalink":"https://acodetailor.github.io/2021/04/09/problem/","excerpt":"","text":"ä¸€ã€é—®é¢˜æè¿°é—®é¢˜â‘ ï¼šä¹‹å‰å¼€å‘äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œé€šè¿‡é¡µé¢åˆå§‹åŒ–gitlabä»£ç è„šæ‰‹æ¶ï¼Œå‘¨ä¸€æ¥æƒ³æ–°å»ºä¸€ä¸ªå·¥ç¨‹æ—¶ï¼Œåˆ›å»ºå¤±è´¥ã€‚gitlabä»“åº“åˆå§‹åŒ–æˆåŠŸï¼Œæ¯æ¬¡åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶æ—¶å°±å¤±è´¥äº†ã€‚ é—®é¢˜â‘¡ï¼šé—®é¢˜â‘ è§£å†³åï¼Œçº¿ä¸Šæµæ°´çº¿æ‰“åŒ…å¤±è´¥ï¼Œæç¤ºnet/httpåŒ…è¦æ±‚go 1.17è€Œæˆ‘ä»¬ç”¨çš„æ˜¯1.13. äºŒã€æ’æŸ¥è¿‡ç¨‹é—®é¢˜â‘ ï¼šæœ¬åœ°debugï¼Œå‘ç°æ¯æ¬¡åœ¨gitlabåˆ›å»ºæ–‡ä»¶æ—¶ï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šåˆå§‹åŒ–æˆåŠŸï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå°±ä¼šæŠ¥400ã€‚æ²¡æœ‰å…¶ä»–çš„æŠ¥é”™ä¿¡æ¯ã€‚è€ƒè™‘åˆ°gitlabåˆšå‡çº§äº†ç‰ˆæœ¬ï¼Œæ‰€ä»¥è‡ªç„¶çš„æ€€ç–‘æ˜¯å‡çº§å¼•å…¥çš„bugã€‚æ¯”å¦‚æ–°ç‰ˆåšäº†é™æµç­‰ã€‚1ã€æ‰¾åˆ°gitlabæœåŠ¡ç«¯çš„å®¹å™¨ï¼Œgitlabæ˜¯è£¸dockerå•ç‹¬éƒ¨ç½²çš„ã€‚è¿›å…¥å®¹å™¨åæŸ¥çœ‹nginxçš„accessã€erroræ—¥å¿—ã€gitlabè‡ªå·±çš„production.log api_json.logã€‚production.logä¸­è®°å½•äº†ç¬¬ä¸€æ¬¡åˆ›å»ºæˆåŠŸçš„è®°å½•ï¼Œstate:200ã€‚api_json.logä¸­å‘ç°äº†å¤±è´¥çš„è®°å½•ã€‚state:400ã€‚ å’Œæ¥å£ä¸€æ ·æ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„æç¤ºã€‚2ã€æŸ¥çœ‹gitlabçš„change.logä¹Ÿæ²¡å‘ç°ç›¸å…³ä¿¡æ¯ã€‚æœ€åæœ¬åœ°æäº¤ä»£ç æ—¶æƒ³èµ·æ¥ï¼Œåˆ«çš„ç»„çš„åŒäº‹ç»™gitlabåŠ äº†ä¸ªé’©å­å‡½æ•°ï¼Œæ ¡éªŒcommitä¿¡æ¯çš„æ ¼å¼ï¼Œæ¯”å¦‚ç¬¦åˆâ€ä»»åŠ¡å· æ“ä½œ ä¿¡æ¯â€çš„æ ¼å¼ã€‚æ€€ç–‘æ˜¯è¿™é‡Œå¼•èµ·çš„ï¼Œä¿®æ”¹ä»£ç çš„commitä¿¡æ¯ã€‚run okã€‚ è§£å†³~é—®é¢˜â‘¡ï¼šé—®é¢˜â‘ è§£å†³åï¼Œæäº¤ä»£ç ï¼Œæµæ°´çº¿æ‰“åŒ…å¤±è´¥ã€‚æç¤ºgoçš„net/httpåŒ…å¼•ç”¨äº†æœ€æ–°çš„ç‰ˆæœ¬ï¼Œéœ€è¦å‡çº§goçš„ç‰ˆæœ¬ã€‚ä½†æ˜¯æœ¬åœ°runå’Œbuildéƒ½æ²¡æœ‰é—®é¢˜ 12&#x2F;go&#x2F;pkg&#x2F;mod&#x2F;golang.org&#x2F;x&#x2F;net@v0.0.0-20211029224645-99673261e6eb&#x2F;http2&#x2F;transport.go:417:45: undefined: os.ErrDeadlineExceedednote: module requires Go 1.17 æˆ‘åªæ”¹äº†ä¸€è¡Œå­—ç¬¦ä¸²æ ¼å¼çš„ä»£ç ï¼Œæ‰€ä»¥å½“æ—¶ä»¥ä¸ºæ˜¯æµæ°´çº¿å‡ºäº†é—®é¢˜ï¼Œçœ‹äº†ä¸€ä¸‹æ‰“åŒ…æ—¥å¿—ï¼Œä¹Ÿæ²¡å‘ç°é—®é¢˜ã€‚è®©è´Ÿè´£æµæ°´çº¿çš„åŒäº‹æ’æŸ¥äº†ã€‚ æœ€ååé¦ˆåªæœ‰æˆ‘çš„å·¥ç¨‹å‡ºç°é—®é¢˜äº†ã€‚è¿™å°±å¾ˆå¤´ç–¼äº†ï¼Œæ¥ç€æ’æŸ¥å§ã€‚å¯ä»¥å‘ç°è¿™ä¸ªå‡ºé—®é¢˜çš„åŒ…æ˜¯10.29 releaseçš„ï¼Œä¸‰å¤©å‰æ€è€ƒæ–¹å‘ï¼šQ1ï¼šæˆ‘å¼•çš„åŒ…æ²¡æœ‰å›ºå®šç‰ˆæœ¬å·ï¼Œé»˜è®¤ä¸‹è½½çš„æœ€æ–°çš„ï¼ŸA1ï¼šæŸ¥çœ‹go.modåå‘ç°æ²¡æœ‰ã€‚Q2ï¼šæˆ‘é—´æ¥å¼•ç”¨çš„åŒ…æ²¡æœ‰å›ºå®šç‰ˆæœ¬å·ï¼Œå¯¼è‡´ä¸‹è½½äº†æœ€æ–°çš„åŒ…ï¼ŸA2ï¼šè¿™ä¸ªå°±å¾ˆå¤´ç–¼äº†ï¼Œè¦ä¸€ä¸ªä¸ªåŒ…æ’æŸ¥å—ï¼Ÿ æƒ³èµ·ä½¿ç”¨go mod graphå¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä¾èµ–å…³ç³»ï¼Œæœ¬åœ°æ‰§è¡Œåå‘ç°æ²¡é—®é¢˜ï¼Œè¿™ä¹Ÿå’Œä¸Šè¾¹æåˆ°çš„æœ¬åœ°æ²¡é—®é¢˜ã€‚Q3ï¼šgithubçš„issueçœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰ç±»ä¼¼çš„ï¼ŸA3ï¼šå‘ç°äº†å‡ ä¸ªissueå’Œæˆ‘é‡åˆ°çš„é—®é¢˜ä¸€æ ·ï¼Œä½†æ˜¯memberè®¤ä¸ºä¸æ˜¯bugï¼Œå·²ç»closeäº†ã€‚https://github.com/golang/go/issues/45950#issuecomment-833054056ã€https://github.com/golang/go/issues/45946#issuecomment-832236587Q4ï¼šæ€€ç–‘åŸºç¡€é•œåƒè¢«æ”¹äº†ï¼Œå¯¼è‡´çš„é—®é¢˜ï¼ŸA4ï¼šæŸ¥çœ‹åŸºç¡€é•œåƒå†å²ï¼Œå‘ç°å¹¶æ²¡æ”¹ã€‚Q5ï¼šå†å»çœ‹çœ‹ä¹‹å‰æˆåŠŸå’Œå¤±è´¥çš„æ‰“åŒ…æ—¥å¿—ï¼Œç»“æœå‘ç°äº†ä¸€ä¸ªä¹‹å‰æˆåŠŸçš„æ—¥å¿—é‡Œä¹Ÿä¼šå»æ‹‰latestçš„åŒ…ï¼Œæˆ‘ä»¥ä¸ºå°±æ˜¯æˆ‘é—´æ¥å¼•ç”¨çš„åŒ…å‡ºäº†é—®é¢˜ï¼Œä¸€é¡¿åæ§½ã€‚ç„¶åå†å»æ‰“åŒ…æœºå™¨ä¸Šçœ‹è¯¦ç»†çš„å¤±è´¥æ—¥å¿—ï¼Œä¸€ä¸ªå¯ç–‘çš„æ—¥å¿—å‡ºç°äº†ã€‚ 1go get: upgraded golang.org/x/net v0.0.0-20201110031124-69a78807bb2b =&gt; v0.0.0-20211101193420-4a448f8816b3ã€‚ ä¸ºä»€ä¹ˆå›å»æ›´æ–°åŒ…ç‰ˆæœ¬å‘¢ã€‚éš¾é“æœ‰go get -u ,å»æŸ¥çœ‹dockerfileï¼Œå‘ç°è·å–swagçš„åŒ…çš„æ—¶å€™ä½¿ç”¨äº†-uä¼šå»æ›´æ–°ç‰ˆæœ¬ã€‚é—®é¢˜è¯­å¥ï¼š 1RUN go get -u github.com/swaggo/swag/cmd/swag@v1.6.7 ä¿®æ”¹åæ‰“åŒ…æˆåŠŸã€‚ è§£å†³~ ä¸‰ã€å¿ƒå¾—é—®é¢˜â‘ å…¶å®åˆ«çš„éƒ¨é—¨æ·»åŠ è¿™ä¸ªå‡½æ•°æˆ‘æ˜¯çŸ¥é“çš„ï¼Œä½†æ˜¯æ²¡æœ‰ç¬¬ä¸€æ—¶é—´æƒ³åˆ°å¯¹è‡ªå·±å¼€å‘çš„åŠŸèƒ½çš„å½±å“ï¼Œå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚é•¿æ—¶é—´æ²¡å‡ºé—®é¢˜ï¼Œå¯¼è‡´çš„æ¾æ‡ˆã€‚é—®é¢˜â‘¡å½“åˆdockerfileçœ‹äº†ä¸€ä¸‹æ²¡é—®é¢˜ï¼Œç›´æ¥ä»åˆ«çš„å·¥ç¨‹èµ‹å€¼ä¿®æ”¹çš„ã€‚æ²¡æœ‰å¯¹æ¯è¡Œä»£ç äº†è§£æ¸…æ¥šï¼Œå¯¼è‡´äº†é—®é¢˜ã€‚æ’æŸ¥æ–¹å‘æ„Ÿè§‰ä¹Ÿæœ‰ç‚¹é—®é¢˜ï¼Œå¯¼è‡´æ—¶é—´æµªè´¹ã€‚åº”è¯¥å…ˆå»æ‰“åŒ…æœºå™¨çœ‹æ—¥å¿—ï¼Œä¹Ÿè®¸è§£å†³çš„å°±å¿«ä¸€äº›äº†ã€‚","categories":[{"name":"problem","slug":"problem","permalink":"https://acodetailor.github.io/categories/problem/"}],"tags":[{"name":"problem","slug":"problem","permalink":"https://acodetailor.github.io/tags/problem/"}]},{"title":"k8s clientSet","slug":"golang","date":"2021-04-09T06:37:13.851Z","updated":"2021-11-03T09:44:18.887Z","comments":false,"path":"2021/04/09/golang/","link":"","permalink":"https://acodetailor.github.io/2021/04/09/golang/","excerpt":"","text":"ä¸€ã€èƒŒæ™¯ä»Šå¤©çœ‹äº†ä¸€ä¸‹å…¬å¸å†…éƒ¨CMDBé€šè¿‡SDKæš´éœ²æ¥å£çš„ä»£ç ï¼Œç»“æ„ä½“ååˆ†æŠ½è±¡ï¼Œçœ‹çš„æˆ‘æœ‰ç‚¹æ™•ã€‚æ‰€ä»¥æƒ³åˆ°äº†k8sçš„clientsetï¼Œå°±æƒ³å­¦ä¹ ä¸€ä¸‹ï¼Œæå‡ä¸€ä¸‹è‡ªå·±çš„ä»£ç ã€‚Do things that are easier to understand, not easier to doã€‚ äºŒã€åˆ†æè¿‡ç¨‹1ã€é¦–å…ˆè¦è·å¾—æ ¹æ®configæ¥åˆ›å»ºå„ä¸ªèµ„æºç»„çš„clientï¼Œç”¨æ¥å’Œapiserveräº¤äº’ã€‚ 123456789101112131415161718192021222324252627282930313233func NewForConfig(c *rest.Config) (*Clientset, error) &#123; configShallowCopy :&#x3D; *c if configShallowCopy.RateLimiter &#x3D;&#x3D; nil &amp;&amp; configShallowCopy.QPS &gt; 0 &#123; if configShallowCopy.Burst &lt;&#x3D; 0 &#123; return nil, fmt.Errorf(&quot;burst is required to be greater than 0 when RateLimiter is not set and QPS is set to greater than 0&quot;) &#125; configShallowCopy.RateLimiter &#x3D; flowcontrol.NewTokenBucketRateLimiter(configShallowCopy.QPS, configShallowCopy.Burst) &#125; var cs Clientset var err error cs.admissionregistrationV1, err &#x3D; admissionregistrationv1.NewForConfig(&amp;configShallowCopy) if err !&#x3D; nil &#123; return nil, err &#125; cs.admissionregistrationV1beta1, err &#x3D; admissionregistrationv1beta1.NewForConfig(&amp;configShallowCopy) if err !&#x3D; nil &#123; return nil, err &#125; cs.internalV1alpha1, err &#x3D; internalv1alpha1.NewForConfig(&amp;configShallowCopy) if err !&#x3D; nil &#123; return nil, err &#125; cs.appsV1, err &#x3D; appsv1.NewForConfig(&amp;configShallowCopy) if err !&#x3D; nil &#123; return nil, err &#125; ...&#x2F;&#x2F;é‡å¤ä»£ç ï¼Œçœç•¥ã€‚ cs.DiscoveryClient, err &#x3D; discovery.NewDiscoveryClientForConfig(&amp;configShallowCopy) if err !&#x3D; nil &#123; return nil, err &#125; return &amp;cs, nil&#125; 1234567891011121314type Clientset struct &#123; *discovery.DiscoveryClient admissionregistrationV1 *admissionregistrationv1.AdmissionregistrationV1Client admissionregistrationV1beta1 *admissionregistrationv1beta1.AdmissionregistrationV1beta1Client internalV1alpha1 *internalv1alpha1.InternalV1alpha1Client appsV1 *appsv1.AppsV1Client ....&#x2F;&#x2F;å„ä¸ªèµ„æºclientå£°æ˜ï¼Œçœç•¥ schedulingV1alpha1 *schedulingv1alpha1.SchedulingV1alpha1Client schedulingV1beta1 *schedulingv1beta1.SchedulingV1beta1Client schedulingV1 *schedulingv1.SchedulingV1Client storageV1beta1 *storagev1beta1.StorageV1beta1Client storageV1 *storagev1.StorageV1Client storageV1alpha1 *storagev1alpha1.StorageV1alpha1Client&#125; 2ã€ç„¶åæˆ‘ä»¬é€‰ä¸€ä¸ªç»„ï¼Œå¦‚appv1çš„ï¼Œclientå£°æ˜å¦‚ä¸‹ã€‚ 1appsV1 *appsv1.AppsV1Client å¯¹åº”çš„ç»“æ„ä½“ 123type AppsV1Client struct &#123; restClient rest.Interface&#125; ç»“æ„ä½“å®ç°äº†ä»¥ä¸‹æ–¹æ³•ï¼Œå®ç°äº†è¯¥åˆ†ç»„ä¸‹çš„èµ„æºæ¥å£çš„ç®¡ç† 12345678910111213141516171819func (c *AppsV1Client) ControllerRevisions(namespace string) ControllerRevisionInterface &#123; return newControllerRevisions(c, namespace)&#125;func (c *AppsV1Client) DaemonSets(namespace string) DaemonSetInterface &#123; return newDaemonSets(c, namespace)&#125;func (c *AppsV1Client) Deployments(namespace string) DeploymentInterface &#123; return newDeployments(c, namespace)&#125;func (c *AppsV1Client) ReplicaSets(namespace string) ReplicaSetInterface &#123; return newReplicaSets(c, namespace)&#125;func (c *AppsV1Client) StatefulSets(namespace string) StatefulSetInterface &#123; return newStatefulSets(c, namespace)&#125; ä»¥deploymentä¸ºä¾‹å­ï¼ŒDeploymentInterfaceåŒ…å«äº†deploymentèµ„æºçš„æ‰€æœ‰æ–¹æ³•ã€‚ 1234567891011121314151617type DeploymentInterface interface &#123; Create(ctx context.Context, deployment *v1.Deployment, opts metav1.CreateOptions) (*v1.Deployment, error) Update(ctx context.Context, deployment *v1.Deployment, opts metav1.UpdateOptions) (*v1.Deployment, error) UpdateStatus(ctx context.Context, deployment *v1.Deployment, opts metav1.UpdateOptions) (*v1.Deployment, error) Delete(ctx context.Context, name string, opts metav1.DeleteOptions) error DeleteCollection(ctx context.Context, opts metav1.DeleteOptions, listOpts metav1.ListOptions) error Get(ctx context.Context, name string, opts metav1.GetOptions) (*v1.Deployment, error) List(ctx context.Context, opts metav1.ListOptions) (*v1.DeploymentList, error) Watch(ctx context.Context, opts metav1.ListOptions) (watch.Interface, error) Patch(ctx context.Context, name string, pt types.PatchType, data []byte, opts metav1.PatchOptions, subresources ...string) (result *v1.Deployment, err error) Apply(ctx context.Context, deployment *appsv1.DeploymentApplyConfiguration, opts metav1.ApplyOptions) (result *v1.Deployment, err error) ApplyStatus(ctx context.Context, deployment *appsv1.DeploymentApplyConfiguration, opts metav1.ApplyOptions) (result *v1.Deployment, err error) GetScale(ctx context.Context, deploymentName string, options metav1.GetOptions) (*autoscalingv1.Scale, error) UpdateScale(ctx context.Context, deploymentName string, scale *autoscalingv1.Scale, opts metav1.UpdateOptions) (*autoscalingv1.Scale, error) DeploymentExpansion&#125; è¿™æ ·å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹ç±»ä¼¼builderæ¨¡å¼æ¥è°ƒç”¨ï¼Œæ„Ÿè§‰è¿˜æ˜¯å¾ˆç®€æ´ã€æ¸…æ¥šçš„ã€‚ 1client.AppsV1().Deployments(&quot;test&quot;).List(ctx,opts) æ¯æ¬¡è¯»k8sçš„ä»£ç éƒ½æœ‰æ”¶è·ï¼","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"}]},{"title":"terraform cloud CLI","slug":"terraform_cloud","date":"2021-04-07T02:02:39.990Z","updated":"2021-04-28T06:34:43.256Z","comments":false,"path":"2021/04/07/terraform_cloud/","link":"","permalink":"https://acodetailor.github.io/2021/04/07/terraform_cloud/","excerpt":"","text":"ä¸€ã€ç®€ä»‹ terraformè‡ªèº«æä¾›å¯ä¸€ä¸ªæœºåˆ¶ï¼ˆç±»ä¼¼CI/CDçš„æµæ°´çº¿ï¼‰ï¼Œå¯ä»¥é…ç½®è‡ªå·±çš„gitåº“ï¼Œæ ¹æ®gitåº“æ–‡ä»¶å†…å®¹çš„å˜åŒ–ï¼Œæ‰§è¡Œplanã€applyï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œã€‚ä»¥åŠé…ç½®å˜é‡æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€stateæ–‡ä»¶ç»Ÿä¸€å­˜å‚¨ç­‰ç­‰åŠŸèƒ½ã€‚ äºŒã€å¯¹æ¯”1ã€ä½¿ç”¨terraformäºŒè¿›åˆ¶ã€‚ éœ€è¦ä¸‹è½½provider(terraform init) ç¼–å†™tfæ–‡ä»¶ï¼Œbackendå­˜å‚¨ã€‚ä¹Ÿéœ€è¦ç»Ÿä¸€çš„é…ç½®ç®¡ç†ã€‚ æ¯æ¬¡æ‰‹åŠ¨è§¦å‘ã€‚ 2ã€ä½¿ç”¨Cloud CLIã€‚ ä¸éœ€è¦å‡†å¤‡provider ç»Ÿä¸€çš„é…ç½®ç®¡ç† git pushåå³è§¦å‘ terraform ä¸‰ã€æ —å­1ã€åˆ›å»ºç»„ç»‡ terraformç½‘ç«™åˆ›å»ºå³å¯ã€‚ https://app.terraform.io2ã€é…ç½®gitåº“ å¯ä»¥ä½¿ç”¨ä¸ªäººçš„gitåº“ï¼Œé…ç½®Oauthæƒé™ã€‚æ ¹æ®æç¤º åœ¨github-&gt;setting-&gt;developer settings-&gt; oauth appsç”³è¯·é…ç½®å³å¯ã€‚ 3ã€é€‰æ‹©å·¥ç¨‹ gitæ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œç„¶åå†terraformå¤„é€‰æ‹©è¯¥å·¥ç¨‹ã€‚ 4ã€æµ‹è¯• æ‰§è¡ŒRunå³å¯ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šè§¦å‘ plan,ç„¶åéœ€è¦æ‰‹åŠ¨æ‰§è¡Œapplyã€‚ 5ã€ç»“æœ","categories":[{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/categories/terraform/"}],"tags":[{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/tags/terraform/"}]},{"title":"Kubernetes CRD -- kubebuilderæ­å»º","slug":"k8s_crd","date":"2021-04-02T02:17:18.350Z","updated":"2021-04-28T06:34:43.250Z","comments":false,"path":"2021/04/02/k8s_crd/","link":"","permalink":"https://acodetailor.github.io/2021/04/02/k8s_crd/","excerpt":"","text":"æ¦‚å¿µå®˜æ–¹è§£é‡Šï¼šCustomResourceDefinition API èµ„æºå…è®¸ä½ å®šä¹‰å®šåˆ¶èµ„æºã€‚ å®šä¹‰ CRD å¯¹è±¡çš„æ“ä½œä¼šä½¿ç”¨ä½ æ‰€è®¾å®šçš„åå­—å’Œæ¨¡å¼å®šä¹‰ï¼ˆSchemaï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„å®šåˆ¶èµ„æºï¼Œ Kubernetes API è´Ÿè´£ä¸ºä½ çš„å®šåˆ¶èµ„æºæä¾›å­˜å‚¨å’Œè®¿é—®æœåŠ¡ã€‚ CRD å¯¹è±¡çš„åç§°å¿…é¡»æ˜¯åˆæ³•çš„ DNS å­åŸŸåã€‚ DNSå­åŸŸåè§„åˆ™å¦‚ä¸‹ï¼š ä¸èƒ½è¶…è¿‡253ä¸ªå­—ç¬¦ åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠâ€™-â€˜ å’Œ â€˜.â€™ é¡»ä»¥å­—æ¯æ•°å­—å¼€å¤´ é¡»ä»¥å­—æ¯æ•°å­—ç»“å°¾ ç®€å•æ¥è¯´ï¼Œä½ å¯ä»¥å®šä¹‰åƒk8såŸç”Ÿèµ„æºå¦‚deploymentã€serviceä¸€æ ·å®šä¹‰è‡ªå·±çš„èµ„æºï¼Œè€Œk8sä¼šä¸ºä½ æä¾›å­˜å‚¨ï¼ˆETCDï¼‰,è®¿é—®ï¼ˆkube-apiserverï¼‰ã€‚ è„šæ‰‹æ¶kubebuilder å’Œ operator sdk, ä¸ªäººåªä½¿ç”¨è¿‡kubebuilderã€‚ å®‰è£…kubebuilderä¾èµ–1ã€docker2ã€go å»ºè®®ç‰ˆæœ¬åœ¨1.12ä»¥ä¸Šï¼Œæ”¯æŒ go mod3ã€kustomize ä»£ç†é…ç½®é…ç½®ä¸€ä¸‹ ç»ˆç«¯ä»£ç†ï¼Œå› ä¸ºåˆå§‹åŒ–æ—¶ä¼šæ‹‰å»goçš„ä¾èµ–åŒ…ã€‚go 1.12ä¹‹ä¸‹å¼€å¯ go module 12export GOPROXY=https://goproxy.ioexport GO111MODULE=on å®‰è£…ä¸€ã€å®‰è£…kubebuilderæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚ï¼ˆå¦‚æœcurlä¸‹è½½å¤±è´¥ï¼Œå¤§æ¦‚ç‡æ˜¯ç½‘ç»œåŸå› ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½ï¼Œè§£å‹åˆ°æŒ‡å®šç›®å½•ï¼‰ã€‚ 12345os= $(go env GOOS)arch=$(go env GOARCH)curl -L https://go.kubebuilder.io/dl/2.3.1/$&#123;os&#125;/$&#123;arch&#125; | tar -xz -C /tmp/sudo mv /tmp/kubebuilder_2.3.1_$&#123;os&#125;_$&#123;arch&#125; /usr/local/kubebuilderexport PATH=$PATH:/usr/local/kubebuilder/bin äºŒã€å®‰è£…kustomize 1brew install kustomize ä¸‰ã€å®‰è£…å®ŒæˆåæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ 12345$ kubebuilder versionVersion: version.Version&#123;KubeBuilderVersion:&quot;2.3.1&quot;, KubernetesVendor:&quot;1.16.4&quot;, GitCommit:&quot;8b53abeb4280186e494b726edf8f54ca7aa64a49&quot;, BuildDate:&quot;2020-03-26T16:42:00Z&quot;, GoOs:&quot;unknown&quot;, GoArch:&quot;unknown&quot;&#125;# sam @ MacBook-Pro-2 in ~/tf/alitest [10:45:37]$ kustomize version&#123;Version:kustomize/v3.8.2 GitCommit:e2973f6ecc9be6187cfd5ecf5e180f842249b3c6 BuildDate:2020-09-02T07:01:55+01:00 GoOs:darwin GoArch:amd64&#125; å››ã€åˆå§‹åŒ–å·¥ç¨‹ 12kubebuilder init --domain my.crd.com //åˆå§‹åŒ–å·¥ç¨‹kubebuilder create api --group custom --version v1 --kind Unit //ç”Ÿæˆè„šæ‰‹æ¶ä»£ç  group: æ¯”å¦‚èµ„æºæ–‡ä»¶çš„apps/v1, appså³ä¸ºåˆ†ç»„ï¼Œè¿˜æœ‰å…¶ä»–extensionsã€coresç­‰ã€‚ version: é¡¾åæ€ä¹‰ã€v1å³ä¸ºç‰ˆæœ¬ã€‚ kind: API â€œé¡¶çº§â€èµ„æºå¯¹è±¡çš„ç±»å‹ï¼Œæ¯ä¸ªèµ„æºå¯¹è±¡éƒ½éœ€è¦ Kind æ¥åŒºåˆ†å®ƒè‡ªèº«ä»£è¡¨çš„èµ„æºç±»å‹ã€‚æ¯”å¦‚ pod,deployment. resource: é€šè¿‡ HTTP åè®®ä»¥ JSON æ ¼å¼å‘é€æˆ–è€…è¯»å–çš„èµ„æºå±•ç°å½¢å¼ï¼Œå¯ä»¥ä»¥å•ä¸ªèµ„æºå¯¹è±¡å±•ç°ã€‚ GVK(groupã€versionã€kind):åŒ Kind ä¸æ­¢å¯ä»¥å‡ºç°åœ¨åŒä¸€åˆ†ç»„çš„ä¸åŒç‰ˆæœ¬ä¸­ï¼Œå¦‚ apps/v1beta1 ä¸ apps/v1ï¼Œå®ƒè¿˜å¯èƒ½å‡ºç°åœ¨ä¸åŒçš„åˆ†ç»„ä¸­ï¼Œä¾‹å¦‚ Deployment å¼€å§‹ä»¥ alpha çš„ç‰¹æ€§å‡ºç°åœ¨ extensions åˆ†ç»„ï¼ŒGA ä¹‹åè¢«æ¨è¿›åˆ° apps ç»„ï¼Œæ‰€ä»¥ä¸ºäº†ä¸¥æ ¼åŒºåˆ†ä¸åŒçš„ Kindï¼Œéœ€è¦ç»„åˆ API Groupã€API Version ä¸ Kind æˆä¸º GVKã€‚ GVR(groupã€versionã€resource):GVR å¸¸ç”¨äºç»„åˆæˆ RESTful API è¯·æ±‚è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œé’ˆå¯¹åº”ç”¨ç¨‹åº v1 éƒ¨ç½²çš„ RESTful API è¯·æ±‚å¦‚ä¸‹æ‰€ç¤ºï¼š 1GET /apis/apps/v1/namespaces/&#123;namespace&#125;/deployments/&#123;name&#125;","categories":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"}]},{"title":"Terraformä»‹ç»","slug":"terraform","date":"2021-03-30T02:38:39.714Z","updated":"2021-04-28T06:34:43.270Z","comments":false,"path":"2021/03/30/terraform/","link":"","permalink":"https://acodetailor.github.io/2021/03/30/terraform/","excerpt":"","text":"ç®€ä»‹ï¼šTerraformæ˜¯IT åŸºç¡€æ¶æ„è‡ªåŠ¨åŒ–ç¼–æ’å·¥å…·ï¼Œå®ƒçš„å£å·æ˜¯ â€œWrite,Plan, and create Infrastructure as Codeâ€, åŸºç¡€æ¶æ„å³ä»£ç ã€‚ æ€ä¹ˆç†è§£è¿™å¥è¯ï¼Œæˆ‘ä»¬å…ˆå‡è®¾åœ¨æ²¡æœ‰Terraformçš„å¹´ä»£æˆ‘ä»¬æ˜¯æ€ä¹ˆæ“ä½œäº‘æœåŠ¡ã€‚ æ–¹å¼ä¸€ï¼šç›´æ¥ç™»å…¥åˆ°äº‘å¹³å°çš„ç®¡æ§é¡µé¢ï¼Œäººå·¥ç‚¹å‡»æŒ‰é’®ã€é”®ç›˜æ•²å…¥è¾“å…¥å‚æ•°çš„æ–¹å¼æ¥æ“ä½œï¼Œè¿™ç§æ–¹å¼å¯¹äºå•ä¸ªæˆ–å‡ ä¸ªäº‘æœåŠ¡å™¨è¿˜å¯ä»¥ç»´æŠ¤çš„è¿‡æ¥ï¼Œä½†æ˜¯å½“äº‘æœåŠ¡è§„æ¨¡è¾¾åˆ°å‡ åå‡ ç™¾ç”šè‡³ä¸Šåƒä»¥åï¼Œæ˜æ˜¾è¿™ç§æ–¹å¼å¯¹äºäººåŠ›æ¥è¯´å˜å¾—ä¸å†ç°å®ï¼Œè€Œä¸”å®¹æ˜“è¯¯æ“ä½œã€‚ æ–¹å¼äºŒï¼šäº‘å¹³å°æä¾›äº†å„ç§SDKï¼Œå°†å¯¹äº‘æœåŠ¡çš„æ“ä½œæ‹†è§£æˆä¸€ä¸ªä¸ªçš„APIä¾›ä½¿ç”¨å‚å•†é€šè¿‡ä»£ç æ¥è°ƒç”¨ã€‚è¿™ç§æ–¹å¼æ˜æ˜¾å¥½äºæ–¹å¼ä¸€ï¼Œä½¿å¤§æ‰¹é‡æ“ä½œå˜å¾—å¯èƒ½ï¼Œè€Œä¸”ä»£ç æµ‹è¯•é€šè¿‡åå¯ä»¥é¿å…äººä¸ºè¯¯æ“ä½œã€‚ä½†æ˜¯éšä¹‹å¸¦æ¥çš„é—®é¢˜æ˜¯å‚å•†ä»¬éœ€è¦ä¸“ä¸šçš„å¼€å‘äººå‘˜ï¼ˆJavaã€Pythonã€Phpã€Rubyç­‰ï¼‰ï¼Œè€Œä¸”å¯¹å¤æ‚äº‘å¹³å°çš„æ“ä½œéœ€è¦å†™å¤§é‡çš„ä»£ç ã€‚ æ–¹å¼ä¸‰ï¼šäº‘å¹³å°æä¾›äº†å‘½ä»¤è¡Œæ“ä½œäº‘æœåŠ¡çš„å·¥å…·ï¼Œä¾‹å¦‚AWS CLIï¼Œè¿™æ ·ç§Ÿæˆ·å‚å•†ä¸å†éœ€è¦è½¯ä»¶å¼€å‘äººå‘˜å°±å¯ä»¥å®ç°å¯¹å¹³å°çš„å‘½ä»¤æ“ä½œã€‚å‘½ä»¤å°±åƒSqlä¸€æ ·ï¼Œä½¿ç”¨å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œå…ƒç´ æ¥ç®¡ç†äº‘ã€‚ æ–¹å¼å››ï¼šTerraformä¸»è§’ç™»åœºï¼Œå¦‚æœè¯´æ–¹å¼ä¸‰ä¸­CLIæ˜¯å‘½ä»¤å¼æ“ä½œï¼Œéœ€è¦æ˜ç¡®çš„å‘ŠçŸ¥äº‘æœåŠ¡æœ¬æ¬¡æ“ä½œæ˜¯æŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€è¿˜æ˜¯åˆ é™¤ï¼Œé‚£ä¹ˆTerraformå°±æ˜¯ç›®çš„å¼æ“ä½œï¼Œåœ¨æœ¬åœ°ç»´æŠ¤äº†ä¸€ä»½äº‘æœåŠ¡çŠ¶æ€çš„æ¨¡æ¿ï¼Œæ¨¡æ¿ç¼–æ’æˆä»€ä¹ˆæ ·å­çš„ï¼Œäº‘æœåŠ¡å°±æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚å¯¹æ¯”æ–¹å¼ä¸‰çš„ä¼˜åŠ¿æ˜¯æˆ‘ä»¬åªéœ€è¦ä¸“æ³¨äºç¼–æ’ç»“æœå³å¯ï¼Œä¸éœ€è¦å…³å¿ƒç”¨ä»€ä¹ˆå‘½ä»¤å»æ“ä½œã€‚ Terraformçš„æ„ä¹‰åœ¨äºï¼Œé€šè¿‡åŒä¸€å¥—è§„åˆ™å’Œå‘½ä»¤æ¥æ“ä½œä¸åŒçš„äº‘å¹³å°ï¼ˆåŒ…æ‹¬ç§æœ‰äº‘ï¼‰ã€‚ TerraformçŸ¥è¯†å‡†å¤‡ï¼šæ ¸å¿ƒæ–‡ä»¶æœ‰2ä¸ªï¼Œä¸€ä¸ªæ˜¯ç¼–æ’æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯çŠ¶æ€æ–‡ä»¶ main.tfæ–‡ä»¶ï¼šæ˜¯ä¸šåŠ¡ç¼–æ’çš„ä¸»æ–‡ä»¶ï¼Œå®šåˆ¶äº†ä¸€ç³»åˆ—çš„ç¼–æ’è§„åˆ™ï¼Œåé¢ä¼šæœ‰è¯¦ç»†ä»‹ç»ã€‚ terraform.tfstateï¼šæœ¬åœ°çŠ¶æ€æ–‡ä»¶ï¼Œç›¸å½“äºæœ¬åœ°çš„äº‘æœåŠ¡çŠ¶æ€çš„å¤‡ä»½ï¼Œä¼šå½±å“terraformçš„æ‰§è¡Œè®¡åˆ’ã€‚ å¦‚æœæœ¬åœ°çŠ¶æ€ä¸äº‘æœåŠ¡çŠ¶æ€ä¸ä¸€æ ·æ—¶ä¼šæ€æ ·ï¼Ÿ è¿™ä¸ªå¤§å®¶ä¸éœ€è¦æ‹…å¿ƒï¼Œå‰é¢ä»‹ç»è¿‡Terraformæ˜¯ç›®çš„å¼çš„ç¼–æ’ï¼Œä¼šæŒ‰ç…§é¢„è®¾ç»“æœå®Œæˆç¼–æ’å¹¶æœ€ç»ˆåŒæ­¥æ›´æ–°æœ¬åœ°æ–‡ä»¶ã€‚ Providerï¼šTerraformå®šåˆ¶çš„ä¸€å¥—æ¥å£ï¼Œè·ŸOpenStacké‡ŒDirverã€Javaé‡ŒInterfaceçš„æ¦‚å¿µæ˜¯ä¸€æ ·çš„ï¼Œé˜¿é‡Œäº‘ã€AWSã€ç§æœ‰äº‘ç­‰å¦‚æœæƒ³æ¥å…¥è¿›æ¥è¢«Terraformç¼–æ’å’Œç®¡ç†å°±è¦å®ç°ä¸€å¥—Providerï¼Œè€Œè¿™äº›å®ç°å¯¹äºTerraformçš„é¡¶å±‚ä½¿ç”¨è€…æ¥è¯´æ˜¯æ— æ„ŸçŸ¥çš„ã€‚ Moduleï¼šå¯ä»¥ç†è§£ä¸ºproviderçš„é›†åˆï¼Œå®Œæˆä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½ã€‚ ç›¸å…³å‘½ä»¤ï¼šåˆå§‹åŒ–åˆå§‹åŒ–æœ¬åœ°ç¯å¢ƒï¼Œä¸‹è½½provider,æ ¡éªŒterraformç‰ˆæœ¬ç­‰. 12$ terraform init //è‡ªåŠ¨ä¸‹è½½æœ€æ–°çš„provider$ terraform init -plugin-dir //æŒ‡å®šproviderç›®å½• planæ¯”è¾ƒäº‘ç«¯èµ„æºå’Œæœ¬åœ°stateèµ„æº. 1$ terraform plan éƒ¨ç½²å°†ä¿®æ”¹éƒ¨ç½²åˆ°äº‘ç«¯èµ„æº. 1$ terraform apply åˆ é™¤å°†äº‘ç«¯èµ„æºåˆ é™¤. 1$ terraform destory Exampleåˆ›å»ºé˜¿é‡Œäº‘ç”¨æˆ·ç»„ã€èµ„æºç»„å¹¶ä¸”é…ç½®åªè¯»æƒé™ã€‚æ³¨: alicloud : é˜¿é‡Œäº‘provideråå­—ï¼Œä¸èƒ½ä¿®æ”¹ã€‚ 1234567891011121314151617181920212223242526provider &quot;alicloud&quot; &#123; access_key = &quot;*******************&quot; secret_key = &quot;*************************&quot; region = &quot;cn-beijing&quot; &#125; resource &quot;alicloud_ram_group&quot; &quot;group&quot; &#123; name = &quot;test_group_1000&quot; force = true &#125; resource &quot;alicloud_ram_group_policy_attachment&quot; &quot;attach&quot; &#123; policy_name = &quot;ReadOnlyAccess&quot; policy_type = &quot;System&quot; group_name = alicloud_ram_group.group.name &#125; resource &quot;alicloud_resource_manager_resource_group&quot; &quot;example&quot; &#123; resource_group_name = &quot;tftest01&quot; display_name = &quot;tftest01&quot; &#125; data &quot;alicloud_account&quot; &quot;example&quot; &#123;&#125; resource &quot;alicloud_resource_manager_policy_attachment&quot; &quot;example&quot; &#123; policy_name = &quot;ReadOnlyAccess&quot; policy_type = &quot;System&quot; principal_name = format(&quot;%s@group.%s.onaliyun.com&quot;, alicloud_ram_group.group.name, data.alicloud_account.example.id) principal_type = &quot;IMSGroup&quot; resource_group_id = alicloud_resource_manager_resource_group.example.id &#125; å…¶ä»–1ã€é…ç½®terraformè‡ªåŠ¨è¡¥å…¨ 1$ terraform -install-autocomplete 2ã€æŸ¥çœ‹terraformçš„æ—¥å¿— 12$ export TF_LOG=TRACE$ export TF_LOG_PATH=/var/log/terraform.log 3ã€terraform é€šè¿‡é…ç½®æ–‡ä»¶æˆ–è€…ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®æ–‡ä»¶ç›®å½•(è‡ªå·±åˆ›å»º) 1$ $HOME/.terraformrc ç¯å¢ƒå˜é‡ 1$ os.Setenv(&quot;TF_PLUGIN_CACHE_DIR&quot;, &quot;/tmp/provider&quot;) // add provider cache stateæ–‡ä»¶å­˜å‚¨ï¼Œæ”¯æŒconsulã€ossç­‰12345678910111213terraform &#123; backend &quot;consul&quot; &#123; address = &quot;consul.example.com&quot; scheme = &quot;https&quot; path = &quot;full/path&quot; &#125;&#125;data &quot;terraform_remote_state&quot; &quot;foo&quot; &#123; backend = &quot;consul&quot; config = &#123; path = &quot;full/path&quot; &#125;&#125; å‚è€ƒï¼š https://theithollow.com/2018/05/21/using-hashicorp-consul-to-store-terraform-state/ è¯­æ³• å•è¡Œæ³¨é‡Šä»¥ # å¼€å¤´ å¤šè¡Œæ³¨é‡Šç”¨ /* å’Œ */ æ¢è¡Œ å€¼ä½¿ç”¨ key = value çš„è¯­æ³•åˆ†é…ï¼ˆç©ºæ ¼æ— å…³ç´§è¦ï¼‰ã€‚è¯¥å€¼å¯ä»¥æ˜¯ä»»ä½•åŸè¯­ï¼ˆå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œå¸ƒå°”å€¼ï¼‰ï¼Œåˆ—è¡¨æˆ–æ˜ å°„ã€‚ å­—ç¬¦ä¸²ä¸ºåŒå¼•å·ã€‚ å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ ${} åŒ…è£…çš„è¯­æ³•å¯¹å…¶ä»–å€¼è¿›è¡Œæ’å€¼ï¼Œä¾‹å¦‚ ${var.foo} ã€‚æ­¤å¤„è®°å½•äº†å®Œæ•´çš„å†…æ’è¯­æ³•ã€‚ å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨å¤–å£³æ ·å¼çš„â€œ here docâ€è¯­æ³•ï¼Œè¯¥å­—ç¬¦ä¸²ä»¥ç±»ä¼¼ &lt;&lt;EOF çš„æ ‡è®°å¼€å¤´ï¼Œç„¶åä»¥ EOF ç»“å°¾ã€‚å­—ç¬¦ä¸²å’Œç»“æŸæ ‡å¿—çš„çº¿è·¯å¿…é¡»ä¸èƒ½ç¼©è¿›ã€‚ å‡å®šæ•°å­—ä»¥10ä¸ºåº•ã€‚å¦‚æœä¸ºæ•°å­—åŠ ä¸Š 0x å‰ç¼€ï¼Œåˆ™å°†å…¶è§†ä¸ºåå…­è¿›åˆ¶æ•°å­—ã€‚ å¸ƒå°”å€¼ï¼š true ï¼Œ false ã€‚ åŸå§‹ç±»å‹çš„åˆ—è¡¨å¯ä»¥ç”¨æ–¹æ‹¬å·ï¼ˆ [] ï¼‰åˆ¶æˆã€‚ç¤ºä¾‹ï¼š [â€œfooâ€, â€œbarâ€, â€œbazâ€] ã€‚ å‚è€ƒ https://runebook.dev/zh-CN/docs/terraform/-index-#Alicloud https://www.terraform.io/","categories":[{"name":"Cloud","slug":"Cloud","permalink":"https://acodetailor.github.io/categories/Cloud/"}],"tags":[{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/tags/terraform/"}]}],"categories":[{"name":"DB","slug":"DB","permalink":"https://acodetailor.github.io/categories/DB/"},{"name":"network","slug":"network","permalink":"https://acodetailor.github.io/categories/network/"},{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/categories/k8s/"},{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://acodetailor.github.io/categories/%E8%BF%90%E7%BB%B4/"},{"name":"problem","slug":"problem","permalink":"https://acodetailor.github.io/categories/problem/"},{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/categories/terraform/"},{"name":"Cloud","slug":"Cloud","permalink":"https://acodetailor.github.io/categories/Cloud/"}],"tags":[{"name":"cache","slug":"cache","permalink":"https://acodetailor.github.io/tags/cache/"},{"name":"Linux","slug":"Linux","permalink":"https://acodetailor.github.io/tags/Linux/"},{"name":"knative","slug":"knative","permalink":"https://acodetailor.github.io/tags/knative/"},{"name":"oom","slug":"oom","permalink":"https://acodetailor.github.io/tags/oom/"},{"name":"k8s","slug":"k8s","permalink":"https://acodetailor.github.io/tags/k8s/"},{"name":"problem","slug":"problem","permalink":"https://acodetailor.github.io/tags/problem/"},{"name":"terraform","slug":"terraform","permalink":"https://acodetailor.github.io/tags/terraform/"}]}